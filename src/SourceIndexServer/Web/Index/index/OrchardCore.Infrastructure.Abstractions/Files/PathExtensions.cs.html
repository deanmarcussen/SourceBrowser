<!DOCTYPE html>
<html><head><title>PathExtensions.cs</title><link rel="stylesheet" href="../../styles.css"><script src="../../scripts.js"></script></head>
<body class="cB" onload="i(135);"><div class="dH">
<table style="width: 100%">
<tr><td>File: <a id="filePath" class="blueLink" href="/#OrchardCore.Infrastructure.Abstractions/Files/PathExtensions.cs" target="_top">Files\PathExtensions.cs</a><br/></td><td></td></tr>
<tr><td>Project: <a id="projectPath" class="blueLink" href="/#OrchardCore.Infrastructure.Abstractions" target="_top">src\OrchardCore\OrchardCore.Infrastructure.Abstractions\OrchardCore.Infrastructure.Abstractions.csproj</a> (OrchardCore.Infrastructure.Abstractions)</td><td></td></tr>
</table>
</div>
<div class="cz"><table class="tb" cellpadding="0" cellspacing="0"><tr><td valign="top" align="right"><pre id="ln"></pre></td><td valign="top" align="left"><pre id="code">
<b>using</b> <span class="i n">System</span>.<span class="i n">Collections</span>.<span class="i n">Generic</span>;
<b>using</b> <span class="i n">System</span>.<span class="i n">Text</span>;
<b>using</b> <span class="i n">Microsoft</span>.<span class="i n">Extensions</span>.<span class="i n">Primitives</span>;
 
<b>namespace</b> <span class="i n">System</span>.<span class="i n">IO</span>
{
    <b>public class</b> <a id="b8d8e19aa0e2bd29" href="../R/b8d8e19aa0e2bd29.html" target="n" data-glyph="0,0" class="t t"><span id="210c0798f6415c80">PathExtensions</span></a>
    {
        <b>public static readonly char</b>[] <a id="9ae70406377cab32" href="../R/9ae70406377cab32.html" target="n" data-glyph="42,1" class="i field">PathSeparators</a> = <b>new</b>[] { <span class="s">&#39;/&#39;</span>, <span class="s">&#39;\\&#39;</span> };
        <b>private const string</b> <a id="ab1b8b8101a9d2e0" href="../R/ab1b8b8101a9d2e0.html" target="n" data-glyph="10,1" class="i field">CurrentDirectoryToken</a> = <span class="s">&quot;.&quot;</span>;
        <b>private const string</b> <a id="5b2c27a8622794e7" href="../R/5b2c27a8622794e7.html" target="n" data-glyph="10,1" class="i field">ParentDirectoryToken</a> = <span class="s">&quot;..&quot;</span>;
 
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">summary</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> Combines two path parts</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;/</span><span class="c">summary</span><span class="c">&gt;</span>
        <b>public static string</b> <a id="5a7947600a87dc2e" href="../R/5a7947600a87dc2e.html" target="n" data-glyph="72,1" class="i method">Combine</a>(<a href="@1@System.Runtime/A.html#8281103e6f23cb5c" class="k">string</a> <span id="r0 rd" class="r0 r">path</span>, <a href="@1@System.Runtime/A.html#8281103e6f23cb5c" class="k">string</a> <span id="r1 rd" class="r1 r">other</span> = <b>null</b>)
        {
            <b>if</b> (<a href="@1@System.Runtime/A.html#8281103e6f23cb5c" class="t t">String</a>.<a href="@1@System.Runtime/A.html#55e241b6143365ef" class="i method">IsNullOrWhiteSpace</a>(<span class="r1 r">other</span>))
            {
                <b>return</b> <span class="r0 r">path</span>;
            }
 
            <b>if</b> (<span class="r1 r">other</span>.<a href="@1@System.Runtime/A.html#df82e02d721cc7f5" class="i method">StartsWith</a>(<span class="s">&#39;/&#39;</span>) || <span class="r1 r">other</span>.<a href="@1@System.Runtime/A.html#df82e02d721cc7f5" class="i method">StartsWith</a>(<span class="s">&#39;\\&#39;</span>))
            {
                <span class="c">// &quot;other&quot; is already an app-rooted path. Return it as-is.</span>
                <b>return</b> <span class="r1 r">other</span>;
            }
 
            <a href="@1@System.Runtime/A.html#8281103e6f23cb5c" class="k">string</a> <span id="r2 rd" class="r2 r">result</span>;
 
            <a href="@1@System.Runtime/A.html#225942ed7b7a3252" class="k">var</a> <span id="r3 rd" class="r3 r">index</span> = <span class="r0 r">path</span>.<a href="@1@System.Runtime/A.html#51d1286ff6914128" class="i method">LastIndexOfAny</a>(<a href="#9ae70406377cab32" class="i field">PathSeparators</a>);
 
            <b>if</b> (<span class="r3 r">index</span> != <span class="r0 r">path</span>.<a href="@1@System.Runtime/A.html#e13f5829ef28aa07" class="i property">Length</a> - 1)
            {
                <span class="c">// If the first ends in a trailing slash e.g. &quot;/Home/&quot;, assume it&#39;s a directory.</span>
                <span class="r2 r">result</span> = <span class="r0 r">path</span> + <span class="s">&quot;/&quot;</span> + <span class="r1 r">other</span>;
            }
            <b>else</b>
            {
                <span class="r2 r">result</span> = <span class="r0 r">path</span>.<a href="@1@System.Runtime/A.html#8124961f027d9ac9" class="i method">Substring</a>(0, <span class="r3 r">index</span> + 1) + <span class="r1 r">other</span>;
            }
 
            <b>return</b> <span class="r2 r">result</span>;
        }
 
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">summary</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> Combines multiple path parts</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;/</span><span class="c">summary</span><span class="c">&gt;</span>
        <b>public static string</b> <a id="3975c36123ac4e82" href="../R/3975c36123ac4e82.html" target="n" data-glyph="72,1" class="i method">Combine</a>(<a href="@1@System.Runtime/A.html#8281103e6f23cb5c" class="k">string</a> <span id="r4 rd" class="r4 r">path</span>, <b>params string</b>[] <span id="r5 rd" class="r5 r">others</span>)
        {
            <a href="@1@System.Runtime/A.html#8281103e6f23cb5c" class="k">string</a> <span id="r6 rd" class="r6 r">result</span> = <span class="r4 r">path</span>;
 
            <b>for</b> (<a href="@1@System.Runtime/A.html#225942ed7b7a3252" class="k">var</a> <span id="r7 rd" class="r7 r">i</span> = 0; <span class="r7 r">i</span> &lt; <span class="r5 r">others</span>.<a href="@1@System.Runtime/A.html#42e9b7616956cf94" class="i property">Length</a>; <span class="r7 r">i</span>++)
            {
                <span class="r6 r">result</span> = <a href="#5a7947600a87dc2e" class="i method">Combine</a>(<span class="r6 r">result</span>, <span class="r5 r">others</span>[<span class="r7 r">i</span>]);
            }
 
            <b>return</b> <span class="r6 r">result</span>;
        }
 
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">summary</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> Resolves relative segments in a path</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;/</span><span class="c">summary</span><span class="c">&gt;</span>
        <b>public static string</b> <a id="0649d301b1c6c837" href="../R/0649d301b1c6c837.html" target="n" data-glyph="72,1" class="i method">ResolvePath</a>(<a href="@1@System.Runtime/A.html#8281103e6f23cb5c" class="k">string</a> <span id="r8 rd" class="r8 r">path</span>)
        {
            <b>var</b> <span id="r9 rd" class="r9 r">pathSegment</span> = <b>new</b> <span class="t constructor">StringSegment</span>(<span class="r8 r">path</span>);
            <b>if</b> (<span class="r8 r">path</span>[0] == <a href="#9ae70406377cab32" class="i field">PathSeparators</a>[0] || <span class="r8 r">path</span>[0] == <a href="#9ae70406377cab32" class="i field">PathSeparators</a>[1])
            {
                <span class="c">// Leading slashes (e.g. &quot;/Views/Index.cshtml&quot;) always generate an empty first token. Ignore these</span>
                <span class="c">// for purposes of resolution.</span>
                <span class="r9 r">pathSegment</span> = <span class="r9 r">pathSegment</span>.<span class="i method">Subsegment</span>(1);
            }
 
            <b>var</b> <span id="r10 rd" class="r10 r">tokenizer</span> = <b>new</b> <span class="t constructor">StringTokenizer</span>(<span class="r9 r">pathSegment</span>, <a href="#9ae70406377cab32" class="i field">PathSeparators</a>);
            <a href="@1@System.Runtime/A.html#f1b135ff6c380b37" class="k">var</a> <span id="r11 rd" class="r11 r">requiresResolution</span> = <b>false</b>;
            <b>foreach</b> (<b>var</b> <span id="r12 rd" class="r12 r">segment</span> <b>in</b> <span class="r10 r">tokenizer</span>)
            {
                <span class="c">// Determine if we need to do any path resolution.</span>
                <span class="c">// We need to resolve paths with multiple path separators (e.g &quot;//&quot; or &quot;\\&quot;) or, directory traversals e.g. (&quot;../&quot; or &quot;./&quot;).</span>
                <b>if</b> (<span class="r12 r">segment</span>.<span class="i property">Length</span> == 0 ||
                    <span class="r12 r">segment</span>.<span class="i method">Equals</span>(<a href="#5b2c27a8622794e7" class="i field">ParentDirectoryToken</a>) ||
                    <span class="r12 r">segment</span>.<span class="i method">Equals</span>(<a href="#ab1b8b8101a9d2e0" class="i field">CurrentDirectoryToken</a>))
                {
                    <span class="r11 r">requiresResolution</span> = <b>true</b>;
                    <b>break</b>;
                }
            }
 
            <b>if</b> (!<span class="r11 r">requiresResolution</span>)
            {
                <b>return</b> <span class="r8 r">path</span>;
            }
 
            <b>var</b> <span id="r13 rd" class="r13 r">pathSegments</span> = <b>new</b> <span class="t constructor">List</span>&lt;<span class="t t">StringSegment</span>&gt;();
            <b>foreach</b> (<b>var</b> <span id="r14 rd" class="r14 r">segment</span> <b>in</b> <span class="r10 r">tokenizer</span>)
            {
                <b>if</b> (<span class="r14 r">segment</span>.<span class="i property">Length</span> == 0)
                {
                    <span class="c">// Ignore multiple directory separators</span>
                    <b>continue</b>;
                }
                <b>if</b> (<span class="r14 r">segment</span>.<span class="i method">Equals</span>(<a href="#5b2c27a8622794e7" class="i field">ParentDirectoryToken</a>))
                {
                    <b>if</b> (<span class="r13 r">pathSegments</span>.<span class="i property">Count</span> == 0)
                    {
                        <span class="c">// Don&#39;t resolve the path if we ever escape the file system root. We can&#39;t reason about it in a</span>
                        <span class="c">// consistent way.</span>
                        <b>return</b> <span class="r8 r">path</span>;
                    }
                    <span class="r13 r">pathSegments</span>.<span class="i method">RemoveAt</span>(<span class="r13 r">pathSegments</span>.<span class="i property">Count</span> - 1);
                }
                <b>else</b> <b>if</b> (<span class="r14 r">segment</span>.<span class="i method">Equals</span>(<a href="#ab1b8b8101a9d2e0" class="i field">CurrentDirectoryToken</a>))
                {
                    <span class="c">// We already have the current directory</span>
                    <b>continue</b>;
                }
                <b>else</b>
                {
                    <span class="r13 r">pathSegments</span>.<span class="i method">Add</span>(<span class="r14 r">segment</span>);
                }
            }
 
            <a href="@1@System.Runtime/A.html#adf60ee46ebd299f" class="k">var</a> <span id="r15 rd" class="r15 r">builder</span> = <b>new</b> <a href="@1@System.Runtime/A.html#6e631639c1e2746b" class="t constructor">StringBuilder</a>();
            <b>for</b> (<a href="@1@System.Runtime/A.html#225942ed7b7a3252" class="k">var</a> <span id="r16 rd" class="r16 r">i</span> = 0; <span class="r16 r">i</span> &lt; <span class="r13 r">pathSegments</span>.<span class="i property">Count</span>; <span class="r16 r">i</span>++)
            {
                <b>var</b> <span id="r17 rd" class="r17 r">segment</span> = <span class="r13 r">pathSegments</span>[<span class="r16 r">i</span>];
                <span class="r15 r">builder</span>.<a href="@1@System.Runtime/A.html#a2e7c78d85807da5" class="i method">Append</a>(<span class="s">&#39;/&#39;</span>);
                <span class="r15 r">builder</span>.<a href="@1@System.Runtime/A.html#6d48c42f6982ca03" class="i method">Append</a>(<span class="r17 r">segment</span>.<span class="i property">Buffer</span>, <span class="r17 r">segment</span>.<span class="i property">Offset</span>, <span class="r17 r">segment</span>.<span class="i property">Length</span>);
            }
 
            <b>return</b> <span class="r15 r">builder</span>.<a href="@1@System.Runtime/A.html#5a97da49a158a3c9" class="i method">ToString</a>();
        }
    }
}
</pre></td></tr></table></div></body></html>
