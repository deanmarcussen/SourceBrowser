<!DOCTYPE html>
<html><head><title>Startup.cs</title><link rel="stylesheet" href="../styles.css"><script src="../scripts.js"></script></head>
<body class="cB" onload="i(117);"><div class="dH">
<table style="width: 100%">
<tr><td>File: <a id="filePath" class="blueLink" href="/#OrchardCore.Autoroute/Startup.cs" target="_top">Startup.cs</a><br/></td><td></td></tr>
<tr><td>Project: <a id="projectPath" class="blueLink" href="/#OrchardCore.Autoroute" target="_top">src\OrchardCore.Modules\OrchardCore.Autoroute\OrchardCore.Autoroute.csproj</a> (OrchardCore.Autoroute)</td><td></td></tr>
</table>
</div>
<div class="cz"><table class="tb" cellpadding="0" cellspacing="0"><tr><td valign="top" align="right"><pre id="ln"></pre></td><td valign="top" align="left"><pre id="code">
<b>using</b> <span class="i n">System</span>;
<b>using</b> <span class="i">Fluid</span>;
<b>using</b> <span class="i">Fluid</span>.<span class="i">Values</span>;
<b>using</b> <span class="i n">Microsoft</span>.<span class="i n">AspNetCore</span>.<span class="i n">Builder</span>;
<b>using</b> <span class="i n">Microsoft</span>.<span class="i n">AspNetCore</span>.<span class="i n">Routing</span>;
<b>using</b> <span class="i n">Microsoft</span>.<span class="i n">Extensions</span>.<span class="i n">DependencyInjection</span>;
<b>using</b> <span class="i n">OrchardCore</span>.<span class="i n">Autoroute</span>.<span class="i n">Drivers</span>;
<b>using</b> <span class="i n">OrchardCore</span>.<span class="i n">Autoroute</span>.<span class="i n">Handlers</span>;
<b>using</b> <span class="i n">OrchardCore</span>.<span class="i n">Autoroute</span>.<span class="i n">Indexing</span>;
<b>using</b> <span class="i n">OrchardCore</span>.<span class="i n">Autoroute</span>.<span class="i n">Models</span>;
<b>using</b> <span class="i n">OrchardCore</span>.<span class="i n">Autoroute</span>.<span class="i n">Routing</span>;
<b>using</b> <span class="i n">OrchardCore</span>.<span class="i n">Autoroute</span>.<span class="i n">Services</span>;
<b>using</b> <span class="i n">OrchardCore</span>.<span class="i n">Autoroute</span>.<span class="i n">Settings</span>;
<b>using</b> <span class="i n">OrchardCore</span>.<span class="i n">Autoroute</span>.<span class="i n">Sitemaps</span>;
<b>using</b> <span class="i n">OrchardCore</span>.<span class="i n">Autoroute</span>.<span class="i n">ViewModels</span>;
<b>using</b> <span class="i n">OrchardCore</span>.<span class="i n">ContentManagement</span>;
<b>using</b> <span class="i n">OrchardCore</span>.<span class="i n">ContentManagement</span>.<span class="i n">Display</span>.<span class="i n">ContentDisplay</span>;
<b>using</b> <span class="i n">OrchardCore</span>.<span class="i n">ContentManagement</span>.<span class="i n">GraphQL</span>.<span class="i n">Options</span>;
<b>using</b> <span class="i n">OrchardCore</span>.<span class="i n">ContentManagement</span>.<span class="i n">Handlers</span>;
<b>using</b> <span class="i n">OrchardCore</span>.<span class="i n">ContentManagement</span>.<span class="i n">Records</span>;
<b>using</b> <span class="i n">OrchardCore</span>.<span class="i n">ContentManagement</span>.<span class="i n">Routing</span>;
<b>using</b> <span class="i n">OrchardCore</span>.<span class="i n">ContentTypes</span>.<span class="i n">Editors</span>;
<b>using</b> <span class="i n">OrchardCore</span>.<span class="i n">Data</span>;
<b>using</b> <span class="i n">OrchardCore</span>.<span class="i n">Data</span>.<span class="i n">Migration</span>;
<b>using</b> <span class="i n">OrchardCore</span>.<span class="i n">Indexing</span>;
<b>using</b> <span class="i n">OrchardCore</span>.<span class="i n">Liquid</span>;
<b>using</b> <span class="i n">OrchardCore</span>.<span class="i">Modules</span>;
<b>using</b> <span class="i n">OrchardCore</span>.<span class="i">Routing</span>;
<b>using</b> <span class="i n">OrchardCore</span>.<span class="i">Security</span>.<span class="i">Permissions</span>;
<b>using</b> <span class="i n">OrchardCore</span>.<span class="i n">Sitemaps</span>.<span class="i n">Services</span>;
 
<b>namespace</b> <span class="i n">OrchardCore</span>.<span class="i n">Autoroute</span>
{
    <b>public class</b> <a id="b5f649e92c5fca6c" href="R/../../0000000000.html" target="n" data-glyph="0,0" class="t t"><span id="c24bc3c80cba4392">Startup</span></a> : <span class="i">StartupBase</span>
    {
        <b>public override int</b> <a id="2cf74f55ce10497b" href="R/../../0000000000.html" target="n" data-glyph="102,1" class="i property">ConfigureOrder</a> =&gt; -100;
 
        <b>public override void</b> <a id="ef1e13fa1b9202e1" href="R/../../0000000000.html" target="n" data-glyph="72,1" class="i method">ConfigureServices</a>(<span class="t t">IServiceCollection</span> <span id="r0 rd" class="r0 r">services</span>)
        {
            <span class="r0 r">services</span>.<span class="i method">Configure</span>&lt;<span class="i">TemplateOptions</span>&gt;(<span id="r1 rd" class="r1 r">o</span> =&gt;
            {
                <span class="r1 r">o</span>.<span class="i">MemberAccessStrategy</span>.<span class="i">Register</span>&lt;<a href="ViewModels/AutoroutePartViewModel.cs.html#5f7fbf57d338ac27" class="t t">AutoroutePartViewModel</a>&gt;();
 
                <span class="r1 r">o</span>.<span class="i">MemberAccessStrategy</span>.<span class="i">Register</span>&lt;<a href="/OrchardCore.Liquid.Abstractions/A.html#81d9791dc0fbd3b2" class="t t">LiquidContentAccessor</a>, <a href="/OrchardCore.Liquid.Abstractions/A.html#a44f08e82995471c" class="t t">LiquidPropertyAccessor</a>&gt;(<span class="s">&quot;Slug&quot;</span>, (<span id="r2 rd" class="r2 r">obj</span>, <span id="r3 rd" class="r3 r">context</span>) =&gt;
                {
                    <a href="/OrchardCore.Liquid.Abstractions/A.html#e17bfc00558bbb3a" class="k">var</a> <span id="r4 rd" class="r4 r">liquidTemplateContext</span> = (<a href="/OrchardCore.Liquid.Abstractions/A.html#e17bfc00558bbb3a" class="t t">LiquidTemplateContext</a>)<span class="r3 r">context</span>;
 
                    <b>return</b> <b>new</b> <span class="t">LiquidPropertyAccessor</span>(<span class="r4 r">liquidTemplateContext</span>, <b>async</b> (<span id="r5 rd" class="r5 r">slug</span>, <span id="r6 rd" class="r6 r">context</span>) =&gt;
                    {
                        <a href="/OrchardCore.ContentManagement.Abstractions/A.html#d0fc4dd4c522c9a4" class="k">var</a> <span id="r7 rd" class="r7 r">autorouteEntries</span> = <span class="r6 r">context</span>.<a href="/OrchardCore.Liquid.Abstractions/A.html#35b8fed4ca686dda" class="i property">Services</a>.<span class="i method">GetRequiredService</span>&lt;<a href="/OrchardCore.ContentManagement.Abstractions/A.html#d0fc4dd4c522c9a4" class="t t">IAutorouteEntries</a>&gt;();
                        <a href="/OrchardCore.ContentManagement.Abstractions/A.html#6ca840219d8dc4cd" class="k">var</a> <span id="r8 rd" class="r8 r">contentManager</span> = <span class="r6 r">context</span>.<a href="/OrchardCore.Liquid.Abstractions/A.html#35b8fed4ca686dda" class="i property">Services</a>.<span class="i method">GetRequiredService</span>&lt;<a href="/OrchardCore.ContentManagement.Abstractions/A.html#6ca840219d8dc4cd" class="t t">IContentManager</a>&gt;();
 
                        <b>if</b> (!<span class="r5 r">slug</span>.<a href="@1@System.Runtime/A.html#df82e02d721cc7f5" class="i method">StartsWith</a>(<span class="s">&#39;/&#39;</span>))
                        {
                            <span class="r5 r">slug</span> = <span class="s">&quot;/&quot;</span> + <span class="r5 r">slug</span>;
                        }
 
                        (<a href="@1@System.Runtime/A.html#f1b135ff6c380b37" class="k">var</a> <span id="r9 rd" class="r9 r">found</span>, <a href="/OrchardCore.ContentManagement.Abstractions/A.html#ebcc749147e70a28" class="k">var</a> <span id="r10 rd" class="r10 r">entry</span>) = <b>await</b> <span class="r7 r">autorouteEntries</span>.<a href="/OrchardCore.ContentManagement.Abstractions/A.html#84527cfcbfbabca0" class="i method">TryGetEntryByPathAsync</a>(<span class="r5 r">slug</span>);
 
                        <b>if</b> (<span class="r9 r">found</span>)
                        {
                            <b>return</b> <span class="i">FluidValue</span>.<span class="i">Create</span>(<b>await</b> <span class="r8 r">contentManager</span>.<a href="/OrchardCore.ContentManagement.Abstractions/A.html#1ffa24bdce599c7d" class="i method">GetAsync</a>(<span class="r10 r">entry</span>.<a href="/OrchardCore.ContentManagement.Abstractions/A.html#ea487d9703b079f6" class="i field">ContentItemId</a>, <span class="r10 r">entry</span>.<a href="/OrchardCore.ContentManagement.Abstractions/A.html#a6022160d9a1cda5" class="i field">JsonPath</a>), <span class="r6 r">context</span>.<span class="i">Options</span>);
                        }
 
                        <b>return</b> <span class="i">NilValue</span>.<span class="i">Instance</span>;
                    });
                });
            });
 
            <span class="c">// Autoroute Part</span>
            <span class="r0 r">services</span>.<a href="/OrchardCore.ContentManagement.Abstractions/A.html#0019d3c1a0518f06" class="i method">AddContentPart</a>&lt;<a href="Models/AutoroutePart.cs.html#44e68b85ecd6deaa" class="t t">AutoroutePart</a>&gt;()
                .<span class="i">UseDisplayDriver</span>&lt;<a href="Drivers/AutoroutePartDisplayDriver.cs.html#154084a7217f8218" class="t t">AutoroutePartDisplayDriver</a>&gt;()
                .<span class="i">AddHandler</span>&lt;<a href="Handlers/AutoroutePartHandler.cs.html#e77c55c42d8c5b93" class="t t">AutoroutePartHandler</a>&gt;();
 
            <span class="r0 r">services</span>.<span class="i method">AddScoped</span>&lt;<a href="/OrchardCore.ContentManagement.Abstractions/A.html#887416973166e420" class="t t">IContentHandler</a>, <a href="Handlers/DefaultRouteContentHandler.cs.html#d07f2040e915f5cc" class="t t">DefaultRouteContentHandler</a>&gt;();
            <span class="r0 r">services</span>.<span class="i method">AddScoped</span>&lt;<a href="/OrchardCore.ContentManagement.Abstractions/A.html#887416973166e420" class="t t">IContentHandler</a>, <a href="Handlers/AutorouteContentHandler.cs.html#bb9ae21a77c3f7fc" class="t t">AutorouteContentHandler</a>&gt;();
            <span class="r0 r">services</span>.<span class="i">AddScoped</span>&lt;<span class="i">IPermissionProvider</span>, <a href="Permissions.cs.html#0b3ee53a0a2711e1" class="t t">Permissions</a>&gt;();
            <span class="r0 r">services</span>.<span class="i method">AddScoped</span>&lt;<a href="/OrchardCore.ContentTypes.Abstractions/A.html#dd1845d853c10401" class="t t">IContentTypePartDefinitionDisplayDriver</a>, <a href="Settings/AutoroutePartSettingsDisplayDriver.cs.html#fcc7305398666397" class="t t">AutoroutePartSettingsDisplayDriver</a>&gt;();
            <span class="r0 r">services</span>.<span class="i method">AddScoped</span>&lt;<a href="/OrchardCore.Indexing.Abstractions/A.html#d17781887b83d515" class="t t">IContentPartIndexHandler</a>, <a href="Indexing/AutoroutePartIndexHandler.cs.html#e49bfa7e72c54649" class="t t">AutoroutePartIndexHandler</a>&gt;();
 
            <span class="r0 r">services</span>.<span class="i method">AddScoped</span>&lt;<a href="Indexes/AutoroutePartIndex.cs.html#4ed38e5a772fd87d" class="t t">AutoroutePartIndexProvider</a>&gt;();
            <span class="r0 r">services</span>.<span class="i method">AddScoped</span>&lt;<span class="i">IScopedIndexProvider</span>&gt;(<span id="r11 rd" class="r11 r">sp</span> =&gt; <span class="r11 r">sp</span>.<span class="i method">GetRequiredService</span>&lt;<a href="Indexes/AutoroutePartIndex.cs.html#4ed38e5a772fd87d" class="t t">AutoroutePartIndexProvider</a>&gt;());
            <span class="r0 r">services</span>.<span class="i method">AddScoped</span>&lt;<a href="/OrchardCore.ContentManagement.Abstractions/A.html#887416973166e420" class="t t">IContentHandler</a>&gt;(<span id="r12 rd" class="r12 r">sp</span> =&gt; <span class="r12 r">sp</span>.<span class="i method">GetRequiredService</span>&lt;<a href="Indexes/AutoroutePartIndex.cs.html#4ed38e5a772fd87d" class="t t">AutoroutePartIndexProvider</a>&gt;());
 
            <span class="r0 r">services</span>.<span class="i">AddScoped</span>&lt;<span class="i">IDataMigration</span>, <a href="Migrations.cs.html#d8bca70ca6c5988d" class="t t">Migrations</a>&gt;();
            <span class="r0 r">services</span>.<span class="i method">AddSingleton</span>&lt;<a href="/OrchardCore.ContentManagement.Abstractions/A.html#d0fc4dd4c522c9a4" class="t t">IAutorouteEntries</a>, <a href="Services/AutorouteEntries.cs.html#5f2f83533334d24b" class="t t">AutorouteEntries</a>&gt;();
            <span class="r0 r">services</span>.<span class="i method">AddScoped</span>&lt;<a href="/OrchardCore.ContentManagement.Abstractions/A.html#add47e186a57296c" class="t t">IContentHandleProvider</a>, <a href="Services/AutorouteHandleProvider.cs.html#d0a66fde8b9c06a4" class="t t">AutorouteHandleProvider</a>&gt;();
 
            <span class="r0 r">services</span>.<span class="i method">Configure</span>&lt;<a href="/OrchardCore.ContentManagement.GraphQL/A.html#5dba51e923df7933" class="t t">GraphQLContentOptions</a>&gt;(<span id="r13 rd" class="r13 r">options</span> =&gt;
            {
                <span class="r13 r">options</span>.<a href="/OrchardCore.ContentManagement.GraphQL/A.html#d00ca9a7928df6ae" class="i method">ConfigurePart</a>&lt;<a href="Models/AutoroutePart.cs.html#44e68b85ecd6deaa" class="t t">AutoroutePart</a>&gt;(<span id="r14 rd" class="r14 r">partOptions</span> =&gt;
                {
                    <span class="r14 r">partOptions</span>.<a href="/OrchardCore.ContentManagement.GraphQL/A.html#e86b7df34e5c3f0c" class="i property">Collapse</a> = <b>true</b>;
                });
            });
 
            <span class="r0 r">services</span>.<span class="i method">AddSingleton</span>&lt;<a href="Routing/AutoRouteTransformer.cs.html#5552fd81a7acf737" class="t t">AutoRouteTransformer</a>&gt;();
            <span class="r0 r">services</span>.<span class="i">AddSingleton</span>&lt;<span class="i">IShellRouteValuesAddressScheme</span>, <a href="Routing/AutorouteValuesAddressScheme.cs.html#f170259baf27fa96" class="t t">AutoRouteValuesAddressScheme</a>&gt;();
        }
 
        <b>public override void</b> <a id="69275348f33f4a60" href="R/../../0000000000.html" target="n" data-glyph="72,1" class="i method">Configure</a>(<span class="t t">IApplicationBuilder</span> <span id="r15 rd" class="r15 r">app</span>, <span class="t t">IEndpointRouteBuilder</span> <span id="r16 rd" class="r16 r">routes</span>, <span class="t t">IServiceProvider</span> <span id="r17 rd" class="r17 r">serviceProvider</span>)
        {
            <span class="c">// The 1st segment prevents the transformer to be executed for the home.</span>
            <span class="r16 r">routes</span>.<span class="i method">MapDynamicControllerRoute</span>&lt;<a href="Routing/AutoRouteTransformer.cs.html#5552fd81a7acf737" class="t t">AutoRouteTransformer</a>&gt;(<span class="s">&quot;/{any}/{**slug}&quot;</span>);
        }
    }
 
    [<span class="i">RequireFeatures</span>(<span class="s">&quot;OrchardCore.Sitemaps&quot;</span>)]
    <b>public class</b> <a id="2c24329203e2103b" href="R/../../0000000000.html" target="n" data-glyph="0,0" class="t t"><span id="7e9d0210b6184491">SitemapStartup</span></a> : <span class="i">StartupBase</span>
    {
        <b>public override void</b> <a id="271c701d50127c13" href="R/../../0000000000.html" target="n" data-glyph="72,1" class="i method">ConfigureServices</a>(<span class="t t">IServiceCollection</span> <span id="r18 rd" class="r18 r">services</span>)
        {
            <span class="r18 r">services</span>.<span class="i method">AddScoped</span>&lt;<a href="/OrchardCore.Sitemaps.Abstractions/A.html#d079d511d11bcf42" class="t t">IRouteableContentTypeProvider</a>, <a href="Sitemaps/AutorouteContentTypeProvider.cs.html#7d418a211c313517" class="t t">AutorouteContentTypeProvider</a>&gt;();
        }
    }
}
</pre></td></tr></table></div></body></html>
