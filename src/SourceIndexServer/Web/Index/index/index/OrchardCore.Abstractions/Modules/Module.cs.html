<!DOCTYPE html>
<html><head><title>Module.cs</title><link rel="stylesheet" href="../../styles.css"><script src="../../scripts.js"></script></head>
<body class="cB" onload="i(149);"><div class="dH">
<table style="width: 100%">
<tr><td>File: <a id="filePath" class="blueLink" href="/#OrchardCore.Abstractions/Modules/Module.cs" target="_top">Modules\Module.cs</a><br/></td><td></td></tr>
<tr><td>Project: <a id="projectPath" class="blueLink" href="/#OrchardCore.Abstractions" target="_top">src\OrchardCore\OrchardCore.Abstractions\OrchardCore.Abstractions.csproj</a> (OrchardCore.Abstractions)</td><td></td></tr>
</table>
</div>
<div class="cz"><table class="tb" cellpadding="0" cellspacing="0"><tr><td valign="top" align="right"><pre id="ln"></pre></td><td valign="top" align="left"><pre id="code">
<b>using</b> <span class="i n">System</span>;
<b>using</b> <span class="i n">System</span>.<span class="i n">Collections</span>.<span class="i n">Generic</span>;
<b>using</b> <span class="i n">System</span>.<span class="i n">IO</span>;
<b>using</b> <span class="i n">System</span>.<span class="i n">Linq</span>;
<b>using</b> <span class="i n">System</span>.<span class="i n">Reflection</span>;
<b>using</b> <span class="i n">Microsoft</span>.<span class="i n">Extensions</span>.<span class="i n">FileProviders</span>;
<b>using</b> <span class="i n">Microsoft</span>.<span class="i n">Extensions</span>.<span class="i n">FileProviders</span>.<span class="i n">Embedded</span>;
<b>using</b> <span class="i n">OrchardCore</span>.<span class="i n">Modules</span>.<span class="i n">Manifest</span>;
 
<b>namespace</b> <span class="i n">OrchardCore</span>.<span class="i n">Modules</span>
{
    <b>public class</b> <a id="ccbcd233c0339923" href="../R/ccbcd233c0339923.html" target="n" data-glyph="0,0" class="t t">Module</a>
    {
        <b>public const string</b> <a id="7706a96f3e10b8e2" href="../R/7706a96f3e10b8e2.html" target="n" data-glyph="6,1" class="i field">WebRootPath</a> = <span class="s">&quot;wwwroot&quot;</span>;
        <b>public static string</b> <a id="54585ce3729b642e" href="../R/54585ce3729b642e.html" target="n" data-glyph="42,1" class="i field">WebRoot</a> = <a href="#7706a96f3e10b8e2" class="i field">WebRootPath</a> + <span class="s">&quot;/&quot;</span>;
 
        <b>private readonly string</b> <a id="a2a7dcde5bf60f0f" href="../R/a2a7dcde5bf60f0f.html" target="n" data-glyph="46,1" class="i field">_baseNamespace</a>;
        <b>private readonly</b> <a href="@1@System.Runtime/A.html#68b4bb83ce8d1c31" class="t t">DateTimeOffset</a> <a id="8dc0980f270c8686" href="../R/8dc0980f270c8686.html" target="n" data-glyph="46,1" class="i field">_lastModified</a>;
        <b>private readonly</b> <a href="@1@System.Runtime/A.html#20343df0c96b629b" class="t t">IDictionary</a>&lt;<a href="@1@System.Runtime/A.html#8281103e6f23cb5c" class="k">string</a>, <span class="t t">IFileInfo</span>&gt; <a id="e1cd69e9b0175112" href="../R/e1cd69e9b0175112.html" target="n" data-glyph="46,1" class="i field">_fileInfos</a> = <b>new</b> <span class="t constructor">Dictionary</span>&lt;<a href="@1@System.Runtime/A.html#8281103e6f23cb5c" class="k">string</a>, <span class="t t">IFileInfo</span>&gt;();
 
        <b>public</b> <a id="2d95776a79e9d8ad" href="../R/2d95776a79e9d8ad.html" target="n" data-glyph="72,1" class="t constructor">Module</a>(<a href="@1@System.Runtime/A.html#8281103e6f23cb5c" class="k">string</a> <span id="r0 rd" class="r0 r">name</span>, <b>bool</b> <span id="r1 rd" class="r1 r">isApplication</span> = <b>false</b>)
        {
            <b>if</b> (!<a href="@1@System.Runtime/A.html#8281103e6f23cb5c" class="k">string</a>.<a href="@1@System.Runtime/A.html#55e241b6143365ef" class="i method">IsNullOrWhiteSpace</a>(<span class="r0 r">name</span>))
            {
                <a href="#e190252504a904bf" class="i property">Assembly</a> = <a href="@1@System.Runtime/A.html#73b5be5e9c2474b2" class="t t">Assembly</a>.<a href="@1@System.Runtime/A.html#e4d05405b4c63794" class="i method">Load</a>(<b>new</b> <a href="@1@System.Runtime/A.html#669eea1990d45287" class="t constructor">AssemblyName</a>(<span class="r0 r">name</span>));
 
                <a href="#f3f15bb31938a5d0" class="i property">Assets</a> = <a href="#e190252504a904bf" class="i property">Assembly</a>.<a href="@1@System.Runtime/A.html#7d3ef2191d8b2078" class="i method">GetCustomAttributes</a>&lt;<a href="Manifest/ModuleAssetAttribute.cs.html#ae7b1a5ae9e0ba70" class="t t">ModuleAssetAttribute</a>&gt;()
                    .<span class="i method">Select</span>(<span id="r2 rd" class="r2 r">a</span> =&gt; <b>new</b> <a href="Asset.cs.html#b4227df9816c1012" class="t constructor">Asset</a>(<span class="r2 r">a</span>.<a href="Manifest/ModuleAssetAttribute.cs.html#08678190a38ddbcd" class="i property">Asset</a>)).<span class="i method">ToArray</span>();
 
                <a href="#559351468e710216" class="i property">AssetPaths</a> = <a href="#f3f15bb31938a5d0" class="i property">Assets</a>.<span class="i method">Select</span>(<span id="r3 rd" class="r3 r">a</span> =&gt; <span class="r3 r">a</span>.<a href="Asset.cs.html#13a76641d2c7cd44" class="i property">ModuleAssetPath</a>).<span class="i method">ToArray</span>();
 
                <a href="@1@System.Runtime/A.html#3acf01620172c7f0" class="k">var</a> <span id="r4 rd" class="r4 r">moduleInfos</span> = <a href="#e190252504a904bf" class="i property">Assembly</a>.<a href="@1@System.Runtime/A.html#7d3ef2191d8b2078" class="i method">GetCustomAttributes</a>&lt;<a href="Manifest/ModuleAttribute.cs.html#436eeb03280341dd" class="t t">ModuleAttribute</a>&gt;();
 
                <a href="#a8c12d7f3340fcfb" class="i property">ModuleInfo</a> =
                    <span class="r4 r">moduleInfos</span>.<span class="i method">Where</span>(<span id="r5 rd" class="r5 r">f</span> =&gt; !(<span class="r5 r">f</span> <b>is</b> <a href="Manifest/ModuleMarkerAttribute.cs.html#7f7ed2e772c123a9" class="t t">ModuleMarkerAttribute</a>)).<span class="i method">FirstOrDefault</span>() ??
                    <span class="r4 r">moduleInfos</span>.<span class="i method">Where</span>(<span id="r6 rd" class="r6 r">f</span> =&gt; <span class="r6 r">f</span> <b>is</b> <a href="Manifest/ModuleMarkerAttribute.cs.html#7f7ed2e772c123a9" class="t t">ModuleMarkerAttribute</a>).<span class="i method">FirstOrDefault</span>() ??
                    <b>new</b> <a href="Manifest/ModuleAttribute.cs.html#0843eaeecb59c64f" class="t constructor">ModuleAttribute</a> { <a href="Manifest/FeatureAttribute.cs.html#25516c548b738f5c" class="i property">Name</a> = <span class="r0 r">name</span> };
 
                <b>var</b> <span id="r7 rd" class="r7 r">features</span> = <a href="#e190252504a904bf" class="i property">Assembly</a>.<a href="@1@System.Runtime/A.html#7d3ef2191d8b2078" class="i method">GetCustomAttributes</a>&lt;<span class="i n">Manifest</span>.<a href="Manifest/FeatureAttribute.cs.html#b654ddb1c1800b28" class="t t">FeatureAttribute</a>&gt;()
                    .<span class="i method">Where</span>(<span id="r8 rd" class="r8 r">f</span> =&gt; !(<span class="r8 r">f</span> <b>is</b> <a href="Manifest/ModuleAttribute.cs.html#436eeb03280341dd" class="t t">ModuleAttribute</a>)).<span class="i method">ToList</span>();
 
                <b>if</b> (<span class="r1 r">isApplication</span>)
                {
                    <a href="#a8c12d7f3340fcfb" class="i property">ModuleInfo</a>.<a href="Manifest/FeatureAttribute.cs.html#25516c548b738f5c" class="i property">Name</a> = <a href="Application.cs.html#5240e78be66d0c6a" class="t t">Application</a>.<a href="Application.cs.html#dda76f1c7c92a11f" class="i field">ModuleName</a>;
                    <a href="#a8c12d7f3340fcfb" class="i property">ModuleInfo</a>.<a href="Manifest/FeatureAttribute.cs.html#b3e9ebedef12cda6" class="i property">Description</a> = <a href="Application.cs.html#5240e78be66d0c6a" class="t t">Application</a>.<a href="Application.cs.html#1797ab5703461fea" class="i field">ModuleDescription</a>;
                    <a href="#a8c12d7f3340fcfb" class="i property">ModuleInfo</a>.<a href="Manifest/FeatureAttribute.cs.html#c2f95f0b3a8a1c9c" class="i property">Priority</a> = <a href="Application.cs.html#5240e78be66d0c6a" class="t t">Application</a>.<a href="Application.cs.html#386350ef0b565715" class="i field">ModulePriority</a>;
                    <a href="#a8c12d7f3340fcfb" class="i property">ModuleInfo</a>.<a href="Manifest/FeatureAttribute.cs.html#a03df269d4731dd7" class="i property">Category</a> = <a href="Application.cs.html#5240e78be66d0c6a" class="t t">Application</a>.<a href="Application.cs.html#eba2dc80fc510d2f" class="i field">ModuleCategory</a>;
                    <a href="#a8c12d7f3340fcfb" class="i property">ModuleInfo</a>.<a href="Manifest/FeatureAttribute.cs.html#b76408a564729005" class="i property">DefaultTenantOnly</a> = <b>true</b>;
 
                    <span class="c">// Adds the application primary feature.</span>
                    <span class="r7 r">features</span>.<span class="i method">Insert</span>(0, <b>new</b> <span class="i n">Manifest</span>.<a href="Manifest/FeatureAttribute.cs.html#e37a4ea993b05a56" class="t constructor">FeatureAttribute</a>()
                    {
                        <a href="Manifest/FeatureAttribute.cs.html#b69c23cee321e12f" class="i property">Id</a> = <span class="r0 r">name</span>,
                        <a href="Manifest/FeatureAttribute.cs.html#25516c548b738f5c" class="i property">Name</a> = <a href="Application.cs.html#5240e78be66d0c6a" class="t t">Application</a>.<a href="Application.cs.html#dda76f1c7c92a11f" class="i field">ModuleName</a>,
                        <a href="Manifest/FeatureAttribute.cs.html#b3e9ebedef12cda6" class="i property">Description</a> = <a href="Application.cs.html#5240e78be66d0c6a" class="t t">Application</a>.<a href="Application.cs.html#1797ab5703461fea" class="i field">ModuleDescription</a>,
                        <a href="Manifest/FeatureAttribute.cs.html#c2f95f0b3a8a1c9c" class="i property">Priority</a> = <a href="Application.cs.html#5240e78be66d0c6a" class="t t">Application</a>.<a href="Application.cs.html#386350ef0b565715" class="i field">ModulePriority</a>,
                        <a href="Manifest/FeatureAttribute.cs.html#a03df269d4731dd7" class="i property">Category</a> = <a href="Application.cs.html#5240e78be66d0c6a" class="t t">Application</a>.<a href="Application.cs.html#eba2dc80fc510d2f" class="i field">ModuleCategory</a>,
                        <a href="Manifest/FeatureAttribute.cs.html#b76408a564729005" class="i property">DefaultTenantOnly</a> = <b>true</b>
                    });
 
                    <span class="c">// Adds the application default feature.</span>
                    <span class="r7 r">features</span>.<span class="i method">Insert</span>(1, <b>new</b> <span class="i n">Manifest</span>.<a href="Manifest/FeatureAttribute.cs.html#e37a4ea993b05a56" class="t constructor">FeatureAttribute</a>()
                    {
                        <a href="Manifest/FeatureAttribute.cs.html#b69c23cee321e12f" class="i property">Id</a> = <a href="Application.cs.html#5240e78be66d0c6a" class="t t">Application</a>.<a href="Application.cs.html#8b1c687b24cfe58b" class="i field">DefaultFeatureId</a>,
                        <a href="Manifest/FeatureAttribute.cs.html#25516c548b738f5c" class="i property">Name</a> = <a href="Application.cs.html#5240e78be66d0c6a" class="t t">Application</a>.<a href="Application.cs.html#2d23bb80153d275d" class="i field">DefaultFeatureName</a>,
                        <a href="Manifest/FeatureAttribute.cs.html#b3e9ebedef12cda6" class="i property">Description</a> = <a href="Application.cs.html#5240e78be66d0c6a" class="t t">Application</a>.<a href="Application.cs.html#c5c34f540a4d9df5" class="i field">DefaultFeatureDescription</a>,
                        <a href="Manifest/FeatureAttribute.cs.html#c2f95f0b3a8a1c9c" class="i property">Priority</a> = <a href="Application.cs.html#5240e78be66d0c6a" class="t t">Application</a>.<a href="Application.cs.html#386350ef0b565715" class="i field">ModulePriority</a>,
                        <a href="Manifest/FeatureAttribute.cs.html#a03df269d4731dd7" class="i property">Category</a> = <a href="Application.cs.html#5240e78be66d0c6a" class="t t">Application</a>.<a href="Application.cs.html#eba2dc80fc510d2f" class="i field">ModuleCategory</a>,
                        <a href="Manifest/FeatureAttribute.cs.html#b76408a564729005" class="i property">DefaultTenantOnly</a> = <b>true</b>
                    });
                }
 
                <a href="#a8c12d7f3340fcfb" class="i property">ModuleInfo</a>.<a href="Manifest/ModuleAttribute.cs.html#4c3e9a7b1e190f22" class="i property">Features</a>.<span class="i method">AddRange</span>(<span class="r7 r">features</span>);
 
                <span class="c">// The &#39;ModuleInfo.Id&#39; allows a module project to change its &#39;AssemblyName&#39;</span>
                <span class="c">// without to update the code. If not provided, the assembly name is used.</span>
 
                <a href="@1@System.Runtime/A.html#8281103e6f23cb5c" class="k">var</a> <span id="r9 rd" class="r9 r">logicalName</span> = <a href="#a8c12d7f3340fcfb" class="i property">ModuleInfo</a>.<a href="Manifest/ModuleAttribute.cs.html#4283635fa22c742d" class="i property">Id</a> ?? <span class="r0 r">name</span>;
 
                <a href="#147ef2ed9f2da85c" class="i property">Name</a> = <a href="#a8c12d7f3340fcfb" class="i property">ModuleInfo</a>.<a href="Manifest/ModuleAttribute.cs.html#4283635fa22c742d" class="i property">Id</a> = <span class="r9 r">logicalName</span>;
                <a href="#b09fcb1190176a98" class="i property">SubPath</a> = <a href="Application.cs.html#5240e78be66d0c6a" class="t t">Application</a>.<a href="Application.cs.html#41f34776c4c9c4f6" class="i field">ModulesRoot</a> + <a href="#147ef2ed9f2da85c" class="i property">Name</a>;
                <a href="#763ce8468613ae83" class="i property">Root</a> = <a href="#b09fcb1190176a98" class="i property">SubPath</a> + <span class="s">&#39;/&#39;</span>;
            }
            <b>else</b>
            {
                <a href="#147ef2ed9f2da85c" class="i property">Name</a> = <a href="#763ce8468613ae83" class="i property">Root</a> = <a href="#b09fcb1190176a98" class="i property">SubPath</a> = <a href="@1@System.Runtime/A.html#8281103e6f23cb5c" class="t t">String</a>.<a href="@1@System.Runtime/A.html#c9f70a27facb27cf" class="i field">Empty</a>;
                <a href="#f3f15bb31938a5d0" class="i property">Assets</a> = <span class="t t">Enumerable</span>.<span class="i method">Empty</span>&lt;<a href="Asset.cs.html#c8fc99f70feecf69" class="t t">Asset</a>&gt;();
                <a href="#559351468e710216" class="i property">AssetPaths</a> = <span class="t t">Enumerable</span>.<span class="i method">Empty</span>&lt;<a href="@1@System.Runtime/A.html#8281103e6f23cb5c" class="k">string</a>&gt;();
                <a href="#a8c12d7f3340fcfb" class="i property">ModuleInfo</a> = <b>new</b> <a href="Manifest/ModuleAttribute.cs.html#0843eaeecb59c64f" class="t constructor">ModuleAttribute</a>();
            }
 
            <a href="#a2a7dcde5bf60f0f" class="i field">_baseNamespace</a> = <a href="#147ef2ed9f2da85c" class="i property">Name</a> + <span class="s">&#39;.&#39;</span>;
            <a href="#8dc0980f270c8686" class="i field">_lastModified</a> = <a href="@1@System.Runtime/A.html#68b4bb83ce8d1c31" class="t t">DateTimeOffset</a>.<a href="@1@System.Runtime/A.html#04abe0cac293ebd0" class="i property">UtcNow</a>;
 
            <b>if</b> (!<a href="@1@System.Runtime/A.html#8281103e6f23cb5c" class="k">string</a>.<a href="@1@System.Runtime/A.html#23a8597f842071f4" class="i method">IsNullOrEmpty</a>(<a href="#e190252504a904bf" class="i property">Assembly</a>?.<a href="@1@System.Runtime/A.html#3faa3e0e41d8868b" class="i property">Location</a>))
            {
                <b>try</b>
                {
                    <a href="#8dc0980f270c8686" class="i field">_lastModified</a> = <span class="t t">File</span>.<span class="i method">GetLastWriteTimeUtc</span>(<a href="#e190252504a904bf" class="i property">Assembly</a>.<a href="@1@System.Runtime/A.html#3faa3e0e41d8868b" class="i property">Location</a>);
                }
                <b>catch</b> (<a href="@1@System.Runtime/A.html#f61b250642abadb7" class="t t">PathTooLongException</a>)
                {
                }
                <b>catch</b> (<a href="@1@System.Runtime/A.html#94e3cb4b7b7d78be" class="t t">UnauthorizedAccessException</a>)
                {
                }
            }
        }
 
        <b>public string</b> <a id="147ef2ed9f2da85c" href="../R/147ef2ed9f2da85c.html" target="n" data-glyph="102,1" class="i property">Name</a> { <b>get</b>; }
        <b>public string</b> <a id="763ce8468613ae83" href="../R/763ce8468613ae83.html" target="n" data-glyph="102,1" class="i property">Root</a> { <b>get</b>; }
        <b>public string</b> <a id="b09fcb1190176a98" href="../R/b09fcb1190176a98.html" target="n" data-glyph="102,1" class="i property">SubPath</a> { <b>get</b>; }
        <b>public</b> <a href="@1@System.Runtime/A.html#73b5be5e9c2474b2" class="t t">Assembly</a> <a id="e190252504a904bf" href="../R/e190252504a904bf.html" target="n" data-glyph="102,1" class="i property">Assembly</a> { <b>get</b>; }
        <b>public</b> <a href="@1@System.Runtime/A.html#3acf01620172c7f0" class="t t">IEnumerable</a>&lt;<a href="Asset.cs.html#c8fc99f70feecf69" class="t t">Asset</a>&gt; <a id="f3f15bb31938a5d0" href="../R/f3f15bb31938a5d0.html" target="n" data-glyph="102,1" class="i property">Assets</a> { <b>get</b>; }
        <b>public</b> <a href="@1@System.Runtime/A.html#3acf01620172c7f0" class="t t">IEnumerable</a>&lt;<a href="@1@System.Runtime/A.html#8281103e6f23cb5c" class="k">string</a>&gt; <a id="559351468e710216" href="../R/559351468e710216.html" target="n" data-glyph="102,1" class="i property">AssetPaths</a> { <b>get</b>; }
        <b>public</b> <a href="Manifest/ModuleAttribute.cs.html#436eeb03280341dd" class="t t">ModuleAttribute</a> <a id="a8c12d7f3340fcfb" href="../R/a8c12d7f3340fcfb.html" target="n" data-glyph="102,1" class="i property">ModuleInfo</a> { <b>get</b>; }
 
        <b>public</b> <span class="t t">IFileInfo</span> <a id="c3d768ed13f82528" href="../R/c3d768ed13f82528.html" target="n" data-glyph="72,1" class="i method">GetFileInfo</a>(<a href="@1@System.Runtime/A.html#8281103e6f23cb5c" class="k">string</a> <span id="r10 rd" class="r10 r">subpath</span>)
        {
            <b>if</b> (!<a href="#e1cd69e9b0175112" class="i field">_fileInfos</a>.<a href="@1@System.Runtime/A.html#6b9f9049901aacea" class="i method">TryGetValue</a>(<span class="r10 r">subpath</span>, <b>out</b> <b>var</b> <span id="r11 rd" class="r11 r">fileInfo</span>))
            {
                <b>if</b> (!<a href="#559351468e710216" class="i property">AssetPaths</a>.<span class="i method">Contains</span>(<a href="#763ce8468613ae83" class="i property">Root</a> + <span class="r10 r">subpath</span>))
                {
                    <b>return</b> <b>new</b> <span class="t constructor">NotFoundFileInfo</span>(<span class="r10 r">subpath</span>);
                }
 
                <b>lock</b> (<a href="#e1cd69e9b0175112" class="i field">_fileInfos</a>)
                {
                    <b>if</b> (!<a href="#e1cd69e9b0175112" class="i field">_fileInfos</a>.<a href="@1@System.Runtime/A.html#6b9f9049901aacea" class="i method">TryGetValue</a>(<span class="r10 r">subpath</span>, <b>out</b> <span class="r11 r">fileInfo</span>))
                    {
                        <a href="@1@System.Runtime/A.html#8281103e6f23cb5c" class="k">var</a> <span id="r12 rd" class="r12 r">resourcePath</span> = <a href="#a2a7dcde5bf60f0f" class="i field">_baseNamespace</a> + <span class="r10 r">subpath</span>.<a href="@1@System.Runtime/A.html#987da5dfb39f1927" class="i method">Replace</a>(<span class="s">&#39;/&#39;</span>, <span class="s">&#39;&gt;&#39;</span>);
                        <a href="@1@System.Runtime/A.html#8281103e6f23cb5c" class="k">var</a> <span id="r13 rd" class="r13 r">fileName</span> = <a href="@1@System.Runtime/A.html#090eca8621a248ee" class="t t">Path</a>.<a href="@1@System.Runtime/A.html#95facc58d06cadd0" class="i method">GetFileName</a>(<span class="r10 r">subpath</span>);
 
                        <b>if</b> (<a href="#e190252504a904bf" class="i property">Assembly</a>.<a href="@1@System.Runtime/A.html#d021461a8fae54e5" class="i method">GetManifestResourceInfo</a>(<span class="r12 r">resourcePath</span>) == <b>null</b>)
                        {
                            <b>return</b> <b>new</b> <span class="t constructor">NotFoundFileInfo</span>(<span class="r13 r">fileName</span>);
                        }
 
                        <a href="#e1cd69e9b0175112" class="i field">_fileInfos</a><a href="@1@System.Runtime/A.html#86884956b17e491a">[</a><span class="r10 r">subpath</span>] = <span class="r11 r">fileInfo</span> = <b>new</b> <span class="t constructor">EmbeddedResourceFileInfo</span>(
                            <a href="#e190252504a904bf" class="i property">Assembly</a>, <span class="r12 r">resourcePath</span>, <span class="r13 r">fileName</span>, <a href="#8dc0980f270c8686" class="i field">_lastModified</a>);
                    }
                }
            }
 
            <b>return</b> <span class="r11 r">fileInfo</span>;
        }
    }
}
</pre></td></tr></table></div></body></html>
