<!DOCTYPE html>
<html><head><title>Startup.cs</title><link rel="stylesheet" href="../styles.css"><script src="../scripts.js"></script></head>
<body class="cB" onload="i(76);"><div class="dH">
<table style="width: 100%">
<tr><td>File: <a id="filePath" class="blueLink" href="/#OrchardCore.Setup/Startup.cs" target="_top">Startup.cs</a><br/></td><td></td></tr>
<tr><td>Project: <a id="projectPath" class="blueLink" href="/#OrchardCore.Setup" target="_top">src\OrchardCore.Modules\OrchardCore.Setup\OrchardCore.Setup.csproj</a> (OrchardCore.Setup)</td><td></td></tr>
</table>
</div>
<div class="cz"><table class="tb" cellpadding="0" cellspacing="0"><tr><td valign="top" align="right"><pre id="ln"></pre></td><td valign="top" align="left"><pre id="code">
<b>using</b> <span class="i n">System</span>;
<b>using</b> <span class="i n">System</span>.<span class="i n">Collections</span>.<span class="i n">Generic</span>;
<b>using</b> <span class="i n">System</span>.<span class="i n">Globalization</span>;
<b>using</b> <span class="i n">System</span>.<span class="i n">Linq</span>;
<b>using</b> <span class="i n">Microsoft</span>.<span class="i n">AspNetCore</span>.<span class="i n">Builder</span>;
<b>using</b> <span class="i n">Microsoft</span>.<span class="i n">AspNetCore</span>.<span class="i n">Identity</span>;
<b>using</b> <span class="i n">Microsoft</span>.<span class="i n">AspNetCore</span>.<span class="i n">Routing</span>;
<b>using</b> <span class="i n">Microsoft</span>.<span class="i n">Extensions</span>.<span class="i n">Configuration</span>;
<b>using</b> <span class="i n">Microsoft</span>.<span class="i n">Extensions</span>.<span class="i n">DependencyInjection</span>;
<b>using</b> <span class="i n">Microsoft</span>.<span class="i n">Extensions</span>.<span class="i n">DependencyInjection</span>.<span class="i n">Extensions</span>;
<b>using</b> <span class="i n">Microsoft</span>.<span class="i n">Extensions</span>.<span class="i n">Options</span>;
<b>using</b> <span class="i n">OrchardCore</span>.<span class="i n">Environment</span>.<span class="i">Shell</span>.<span class="i">Configuration</span>;
<b>using</b> <span class="i n">OrchardCore</span>.<span class="i n">Localization</span>;
<b>using</b> <span class="i n">OrchardCore</span>.<span class="i">Modules</span>;
 
<b>namespace</b> <span class="i n">OrchardCore</span>.<span class="i n">Setup</span>
{
    <b>public class</b> <a id="a09d2a86375abe18" href="R/../../0000000000.html" target="n" data-glyph="0,0" class="t t">Startup</a> : <span class="i">StartupBase</span>
    {
        <b>private readonly string</b> <a id="7c8fdb4c565c8c8a" href="R/7c8fdb4c565c8c8a.html" target="n" data-glyph="46,1" class="i field">_defaultCulture</a> = <a href="@1@System.Runtime/A.html#e319c6636909012f" class="t t">CultureInfo</a>.<a href="@1@System.Runtime/A.html#9af43119e0669215" class="i property">InstalledUICulture</a>.<a href="@1@System.Runtime/A.html#a99dfd86b8014a4a" class="i property">Name</a>;
 
        <b>private string</b>[] <a id="1e48b535d571aa0b" href="R/1e48b535d571aa0b.html" target="n" data-glyph="46,1" class="i field">_supportedCultures</a> = <b>new</b> <a href="@1@System.Runtime/A.html#8281103e6f23cb5c" class="k">string</a>[] {
            <span class="s">&quot;ar&quot;</span>, <span class="s">&quot;cs&quot;</span>, <span class="s">&quot;de&quot;</span>, <span class="s">&quot;el&quot;</span>, <span class="s">&quot;en&quot;</span>, <span class="s">&quot;es&quot;</span>, <span class="s">&quot;fa&quot;</span>, <span class="s">&quot;fr&quot;</span>, <span class="s">&quot;it&quot;</span>, <span class="s">&quot;ja&quot;</span>, <span class="s">&quot;pl&quot;</span>, <span class="s">&quot;pt-BR&quot;</span>, <span class="s">&quot;ru&quot;</span>, <span class="s">&quot;sv&quot;</span>, <span class="s">&quot;tr&quot;</span>, <span class="s">&quot;vi&quot;</span>, <span class="s">&quot;zh-CN&quot;</span>, <span class="s">&quot;zh-TW&quot;</span>
        };
 
        <b>public</b> <a id="f257e90ba4515365" href="R/../../0000000000.html" target="n" data-glyph="72,1" class="t constructor">Startup</a>(<span class="i">IShellConfiguration</span> <span id="r0 rd" class="r0 r">shellConfiguration</span>)
        {
            <b>var</b> <span id="r1 rd" class="r1 r">configurationSection</span> = <span class="r0 r">shellConfiguration</span>.<span class="i">GetSection</span>(<span class="s">&quot;OrchardCore_Setup&quot;</span>);
 
            <a href="#7c8fdb4c565c8c8a" class="i field">_defaultCulture</a> = <span class="r1 r">configurationSection</span>[<span class="s">&quot;DefaultCulture&quot;</span>] ?? <a href="#7c8fdb4c565c8c8a" class="i field">_defaultCulture</a>;
            <a href="#1e48b535d571aa0b" class="i field">_supportedCultures</a> = <span class="r1 r">configurationSection</span>.<span class="i">GetSection</span>(<span class="s">&quot;SupportedCultures&quot;</span>).<span class="i">Get</span>&lt;<span class="t t">List</span>&lt;<a href="@1@System.Runtime/A.html#8281103e6f23cb5c" class="k">string</a>&gt;&gt;()?.<span class="i method">ToArray</span>() ?? <a href="#1e48b535d571aa0b" class="i field">_supportedCultures</a>;
        }
 
        <b>public override void</b> <a id="a85058bf776d81b0" href="R/../../0000000000.html" target="n" data-glyph="72,1" class="i method">ConfigureServices</a>(<span class="t t">IServiceCollection</span> <span id="r2 rd" class="r2 r">services</span>)
        {
            <span class="r2 r">services</span>.<a href="/OrchardCore.Localization.Core/A.html#eb043d58df69cec5" class="i method">AddPortableObjectLocalization</a>(<span id="r3 rd" class="r3 r">options</span> =&gt; <span class="r3 r">options</span>.<span class="i property">ResourcesPath</span> = <span class="s">&quot;Localization&quot;</span>);
            <span class="r2 r">services</span>.<span class="i method">Replace</span>(<span class="t t">ServiceDescriptor</span>.<span class="i">Singleton</span>&lt;<span class="i">ILocalizationFileLocationProvider</span>, <a href="ModularPoFileLocationProvider.cs.html#fbda3689e4bb7db8" class="t t">ModularPoFileLocationProvider</a>&gt;());
 
            <span class="r2 r">services</span>.<a href="/OrchardCore.Setup.Core/A.html#b86cd5b65a3fe099" class="i method">AddSetup</a>();
 
            <span class="r2 r">services</span>.<span class="i method">Configure</span>&lt;<span class="t t">IdentityOptions</span>&gt;(<span id="r4 rd" class="r4 r">options</span> =&gt;
            {
                <span class="r4 r">options</span>.<span class="i property">User</span>.<span class="i property">AllowedUserNameCharacters</span> = <span class="s">&quot;abcdefghijklmnopqrstuvwxyzABCDEFGHIJKLMNOPQRSTUVWXYZ0123456789-._+&quot;</span>;
                <span class="r4 r">options</span>.<span class="i property">User</span>.<span class="i property">RequireUniqueEmail</span> = <b>true</b>;
            });
        }
 
        <b>public override void</b> <a id="8491375e9257f165" href="R/../../0000000000.html" target="n" data-glyph="72,1" class="i method">Configure</a>(<span class="t t">IApplicationBuilder</span> <span id="r5 rd" class="r5 r">app</span>, <span class="t t">IEndpointRouteBuilder</span> <span id="r6 rd" class="r6 r">routes</span>, <span class="t t">IServiceProvider</span> <span id="r7 rd" class="r7 r">serviceProvider</span>)
        {
            <b>var</b> <span id="r8 rd" class="r8 r">localizationOptions</span> = <span class="r7 r">serviceProvider</span>.<span class="i method">GetService</span>&lt;<span class="t t">IOptions</span>&lt;<span class="t t">RequestLocalizationOptions</span>&gt;&gt;().<span class="i property">Value</span>;
 
            <b>if</b> (!<a href="@1@System.Runtime/A.html#8281103e6f23cb5c" class="t t">String</a>.<a href="@1@System.Runtime/A.html#23a8597f842071f4" class="i method">IsNullOrEmpty</a>(<a href="#7c8fdb4c565c8c8a" class="i field">_defaultCulture</a>))
            {
                <span class="r8 r">localizationOptions</span>.<span class="i method">SetDefaultCulture</span>(<a href="#7c8fdb4c565c8c8a" class="i field">_defaultCulture</a>);
                <a href="#1e48b535d571aa0b" class="i field">_supportedCultures</a> = <a href="#1e48b535d571aa0b" class="i field">_supportedCultures</a>.<span class="i method">Union</span>(<b>new</b>[] { <a href="#7c8fdb4c565c8c8a" class="i field">_defaultCulture</a> }).<span class="i method">ToArray</span>();
            }
 
            <b>if</b> (<a href="#1e48b535d571aa0b" class="i field">_supportedCultures</a>?.<a href="@1@System.Runtime/A.html#42e9b7616956cf94" class="i property">Length</a> &gt; 0)
            {
                <span class="r8 r">localizationOptions</span>
                    .<span class="i method">AddSupportedCultures</span>(<a href="#1e48b535d571aa0b" class="i field">_supportedCultures</a>)
                    .<span class="i method">AddSupportedUICultures</span>(<a href="#1e48b535d571aa0b" class="i field">_supportedCultures</a>);
            }
 
            <span class="r5 r">app</span>.<span class="i method">UseRequestLocalization</span>(<span class="r8 r">localizationOptions</span>);
 
            <span class="r6 r">routes</span>.<span class="i method">MapAreaControllerRoute</span>(
                <span class="r9 r">name</span>: <span class="s">&quot;Setup&quot;</span>,
                <span class="r10 r">areaName</span>: <span class="s">&quot;OrchardCore.Setup&quot;</span>,
                <span class="r11 r">pattern</span>: <span class="s">&quot;&quot;</span>,
                <span class="r12 r">defaults</span>: <b>new</b> { <a href="#1c8758d845f4a816" class="i property">controller</a> = <span class="s">&quot;Setup&quot;</span>, <a href="#4ce42354c8f69fc1" class="i property">action</a> = <span class="s">&quot;Index&quot;</span> }
            );
        }
    }
}
</pre></td></tr></table></div></body></html>
