<!DOCTYPE html>
<html><head><title>AdminController.cs</title><link rel="stylesheet" href="../../styles.css"><script src="../../scripts.js"></script></head>
<body class="cB" onload="i(84);"><div class="dH">
<table style="width: 100%">
<tr><td>File: <a id="filePath" class="blueLink" href="/#OrchardCore.Widgets/Controllers/AdminController.cs" target="_top">Controllers\AdminController.cs</a><br/></td><td></td></tr>
<tr><td>Project: <a id="projectPath" class="blueLink" href="/#OrchardCore.Widgets" target="_top">src\OrchardCore.Modules\OrchardCore.Widgets\OrchardCore.Widgets.csproj</a> (OrchardCore.Widgets)</td><td></td></tr>
</table>
</div>
<div class="cz"><table class="tb" cellpadding="0" cellspacing="0"><tr><td valign="top" align="right"><pre id="ln"></pre></td><td valign="top" align="left"><pre id="code">
<b>using</b> <span class="i n">System</span>;
<b>using</b> <span class="i n">System</span>.<span class="i n">Threading</span>.<span class="i n">Tasks</span>;
<b>using</b> <span class="i n">Microsoft</span>.<span class="i n">AspNetCore</span>.<span class="i n">Mvc</span>;
<b>using</b> <span class="i n">OrchardCore</span>.<span class="i n">ContentManagement</span>;
<b>using</b> <span class="i n">OrchardCore</span>.<span class="i n">ContentManagement</span>.<span class="i n">Display</span>;
<b>using</b> <span class="i n">OrchardCore</span>.<span class="i">DisplayManagement</span>;
<b>using</b> <span class="i n">OrchardCore</span>.<span class="i">DisplayManagement</span>.<span class="i">ModelBinding</span>;
<b>using</b> <span class="i n">OrchardCore</span>.<span class="i n">Widgets</span>.<span class="i n">Models</span>;
<b>using</b> <span class="i n">OrchardCore</span>.<span class="i n">Widgets</span>.<span class="i n">ViewModels</span>;
 
<b>namespace</b> <span class="i n">OrchardCore</span>.<span class="i n">Widgets</span>.<span class="i n">Controllers</span>
{
    <b>public class</b> <a id="a072089103f24a9d" href="../R/a072089103f24a9d.html" target="n" data-glyph="0,0" class="t t">AdminController</a> : <span class="t t">Controller</span>
    {
        <b>private readonly</b> <a href="/OrchardCore.ContentManagement.Abstractions/A.html#6ca840219d8dc4cd" class="t t">IContentManager</a> <a id="9ae69a9817b170cc" href="../R/9ae69a9817b170cc.html" target="n" data-glyph="46,1" class="i field">_contentManager</a>;
        <b>private readonly</b> <a href="/OrchardCore.ContentManagement.Display/A.html#ccb0f2621bf941ec" class="t t">IContentItemDisplayManager</a> <a id="9455328104c653ed" href="../R/9455328104c653ed.html" target="n" data-glyph="46,1" class="i field">_contentItemDisplayManager</a>;
        <b>private readonly</b> <span class="i">IShapeFactory</span> <a id="54c8a964050a5434" href="../R/54c8a964050a5434.html" target="n" data-glyph="46,1" class="i field">_shapeFactory</a>;
        <b>private readonly</b> <span class="i">IUpdateModelAccessor</span> <a id="cc1fea3a6458433e" href="../R/cc1fea3a6458433e.html" target="n" data-glyph="46,1" class="i field">_updateModelAccessor</a>;
 
        <b>public</b> <a id="ada341af7b58bdaa" href="../R/../../0000000000.html" target="n" data-glyph="72,1" class="t constructor">AdminController</a>(
            <a href="/OrchardCore.ContentManagement.Abstractions/A.html#6ca840219d8dc4cd" class="t t">IContentManager</a> <span id="r0 rd" class="r0 r">contentManager</span>,
            <a href="/OrchardCore.ContentManagement.Display/A.html#ccb0f2621bf941ec" class="t t">IContentItemDisplayManager</a> <span id="r1 rd" class="r1 r">contentItemDisplayManager</span>,
            <span class="i">IShapeFactory</span> <span id="r2 rd" class="r2 r">shapeFactory</span>,
            <span class="i">IUpdateModelAccessor</span> <span id="r3 rd" class="r3 r">updateModelAccessor</span>)
        {
            <a href="#9455328104c653ed" class="i field">_contentItemDisplayManager</a> = <span class="r1 r">contentItemDisplayManager</span>;
            <a href="#9ae69a9817b170cc" class="i field">_contentManager</a> = <span class="r0 r">contentManager</span>;
            <a href="#54c8a964050a5434" class="i field">_shapeFactory</a> = <span class="r2 r">shapeFactory</span>;
            <a href="#cc1fea3a6458433e" class="i field">_updateModelAccessor</a> = <span class="r3 r">updateModelAccessor</span>;
        }
 
        <b>public async</b> <a href="@1@System.Runtime/A.html#5ca7b77f3df89fc6" class="t t">Task</a>&lt;<span class="t t">IActionResult</span>&gt; <a id="be6d8366a06fd09d" href="../R/../../0000000000.html" target="n" data-glyph="72,1" class="i method">BuildEditor</a>(<a href="@1@System.Runtime/A.html#8281103e6f23cb5c" class="k">string</a> <span id="r4 rd" class="r4 r">id</span>, <a href="@1@System.Runtime/A.html#8281103e6f23cb5c" class="k">string</a> <span id="r5 rd" class="r5 r">prefix</span>, <a href="@1@System.Runtime/A.html#8281103e6f23cb5c" class="k">string</a> <span id="r6 rd" class="r6 r">prefixesName</span>, <a href="@1@System.Runtime/A.html#8281103e6f23cb5c" class="k">string</a> <span id="r7 rd" class="r7 r">contentTypesName</span>, <a href="@1@System.Runtime/A.html#8281103e6f23cb5c" class="k">string</a> <span id="r8 rd" class="r8 r">zonesName</span>, <a href="@1@System.Runtime/A.html#8281103e6f23cb5c" class="k">string</a> <span id="r9 rd" class="r9 r">zone</span>, <a href="@1@System.Runtime/A.html#8281103e6f23cb5c" class="k">string</a> <span id="r10 rd" class="r10 r">targetId</span>, <a href="@1@System.Runtime/A.html#8281103e6f23cb5c" class="k">string</a> <span id="r11 rd" class="r11 r">parentContentType</span>, <a href="@1@System.Runtime/A.html#8281103e6f23cb5c" class="k">string</a> <span id="r12 rd" class="r12 r">partName</span>)
        {
            <b>if</b> (<a href="@1@System.Runtime/A.html#8281103e6f23cb5c" class="t t">String</a>.<a href="@1@System.Runtime/A.html#55e241b6143365ef" class="i method">IsNullOrWhiteSpace</a>(<span class="r4 r">id</span>))
            {
                <b>return</b> <span class="i method">NotFound</span>();
            }
 
            <a href="/OrchardCore.ContentManagement.Abstractions/A.html#1099e5a609a8b2e4" class="k">var</a> <span id="r13 rd" class="r13 r">contentItem</span> = <b>await</b> <a href="#9ae69a9817b170cc" class="i field">_contentManager</a>.<a href="/OrchardCore.ContentManagement.Abstractions/A.html#9f72e0fd5ee4423f" class="i method">NewAsync</a>(<span class="r4 r">id</span>);
 
            <span class="r13 r">contentItem</span>.<a href="/OrchardCore.ContentManagement.Abstractions/A.html#61a102b0e5f5d7ab" class="i method">Weld</a>(<b>new</b> <a href="../Models/WidgetMetadata.cs.html#83a3a95d4c505d5b" class="t constructor">WidgetMetadata</a>());
 
            <a href="@1@System.Runtime/A.html#8281103e6f23cb5c" class="k">string</a> <span id="r14 rd" class="r14 r">cardCollectionType</span> = <b>nameof</b>(<a href="../Models/WidgetsListPart.cs.html#57dd55b595663161" class="t t">WidgetsListPart</a>);
 
            <span class="c">//Create a Card Shape</span>
            <b>dynamic</b> <span id="r15 rd" class="r15 r">contentCard</span> = <b>await</b> <a href="#54c8a964050a5434" class="i field">_shapeFactory</a>.<span class="i">New</span>.<span class="i">ContentCard</span>(
                <span class="c">//Updater is the controller for AJAX Requests</span>
                <span class="i">Updater</span>: <a href="#cc1fea3a6458433e" class="i field">_updateModelAccessor</a>.<span class="i">ModelUpdater</span>,
                <span class="c">//Shape Specific</span>
                <span class="i">CollectionShapeType</span>: <span class="r14 r">cardCollectionType</span>,
                <span class="i">ContentItem</span>: <span class="r13 r">contentItem</span>,
                <span class="i">BuildEditor</span>: <b>true</b>,
                <span class="i">ParentContentType</span>: <span class="r11 r">parentContentType</span>,
                <span class="i">CollectionPartName</span>: <span class="r12 r">partName</span>,
                <span class="c">//WidgetListPart Specific</span>
                <span class="i">ZoneValue</span>: <span class="r9 r">zone</span>,
                <span class="c">//Card Specific Properties</span>
                <span class="i">TargetId</span>: <span class="r10 r">targetId</span>,
                <span class="i">Inline</span>: <b>true</b>,
                <span class="i">CanMove</span>: <b>true</b>,
                <span class="i">CanDelete</span>: <b>true</b>,
                <span class="c">//Input hidden</span>
                <span class="c">//Prefixes</span>
                <span class="i">HtmlFieldPrefix</span>: <span class="r5 r">prefix</span>,
                <span class="i">PrefixesId</span>: <span class="r6 r">prefixesName</span>.<a href="@1@System.Runtime/A.html#987da5dfb39f1927" class="i method">Replace</a>(<span class="s">&#39;.&#39;</span>, <span class="s">&#39;_&#39;</span>),
                <span class="i">PrefixesName</span>: <span class="r6 r">prefixesName</span>,
                <span class="c">//ContentTypes</span>
                <span class="i">ContentTypesId</span>: <span class="r7 r">contentTypesName</span>.<a href="@1@System.Runtime/A.html#987da5dfb39f1927" class="i method">Replace</a>(<span class="s">&#39;.&#39;</span>, <span class="s">&#39;_&#39;</span>),
                <span class="i">ContentTypesName</span>: <span class="r7 r">contentTypesName</span>,
                <span class="c">//Zones</span>
                <span class="i">ZonesId</span>: <span class="r8 r">zonesName</span>.<a href="@1@System.Runtime/A.html#987da5dfb39f1927" class="i method">Replace</a>(<span class="s">&#39;.&#39;</span>, <span class="s">&#39;_&#39;</span>),
                <span class="i">ZonesName</span>: <span class="r8 r">zonesName</span>
            );
 
            <a href="../ViewModels/BuildEditorViewModel.cs.html#68fe585ef8ba9fdd" class="k">var</a> <span id="r16 rd" class="r16 r">model</span> = <b>new</b> <a href="../ViewModels/BuildEditorViewModel.cs.html#68fe585ef8ba9fdd" class="t constructor">BuildEditorViewModel</a>
            {
                <a href="../ViewModels/BuildEditorViewModel.cs.html#ccb2ce2433c82528" class="i property">EditorShape</a> = <span class="r15 r">contentCard</span>
            };
 
            <b>return</b> <span class="i method">View</span>(<span class="s">&quot;Display&quot;</span>, <span class="r16 r">model</span>);
        }
    }
}
</pre></td></tr></table></div></body></html>
