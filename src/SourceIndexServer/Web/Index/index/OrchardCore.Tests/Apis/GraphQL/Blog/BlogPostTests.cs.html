<!DOCTYPE html>
<html><head><title>BlogPostTests.cs</title><link rel="stylesheet" href="../../../../styles.css"><script src="../../../../scripts.js"></script></head>
<body class="cB" onload="i(274);"><div class="dH">
<table style="width: 100%">
<tr><td>File: <a id="filePath" class="blueLink" href="/#OrchardCore.Tests/Apis/GraphQL/Blog/BlogPostTests.cs" target="_top">Apis\GraphQL\Blog\BlogPostTests.cs</a><br/></td><td></td></tr>
<tr><td>Project: <a id="projectPath" class="blueLink" href="/#OrchardCore.Tests" target="_top">test\OrchardCore.Tests\OrchardCore.Tests.csproj</a> (OrchardCore.Tests)</td><td></td></tr>
</table>
</div>
<div class="cz"><table class="tb" cellpadding="0" cellspacing="0"><tr><td valign="top" align="right"><pre id="ln"></pre></td><td valign="top" align="left"><pre id="code">
<b>using</b> <span class="i n">System</span>.<span class="i n">Linq</span>;
<b>using</b> <span class="i n">System</span>.<span class="i n">Threading</span>.<span class="i n">Tasks</span>;
<b>using</b> <span class="i n">OrchardCore</span>.<span class="i">Autoroute</span>.<span class="i">Models</span>;
<b>using</b> <span class="i n">OrchardCore</span>.<span class="i">ContentFields</span>.<span class="i">Fields</span>;
<b>using</b> <span class="i n">OrchardCore</span>.<span class="i">ContentManagement</span>;
<b>using</b> <span class="i n">OrchardCore</span>.<span class="i">Lists</span>.<span class="i">Models</span>;
<b>using</b> <span class="i n">OrchardCore</span>.<span class="i n">Tests</span>.<span class="i n">Apis</span>.<span class="i n">Context</span>;
<b>using</b> <span class="i">Xunit</span>;
<b>using</b> <span class="i">GraphQLApi</span> = <span class="i n">OrchardCore</span>.<span class="i n">Apis</span>.<span class="i n">GraphQL</span>;
 
<b>namespace</b> <span class="i n">OrchardCore</span>.<span class="i n">Tests</span>.<span class="i n">Apis</span>.<span class="i n">GraphQL</span>
{
    <b>public class</b> <a id="9f95db5a21b064b1" href="../../../R/../../0000000000.html" target="n" data-glyph="0,0" class="t t"><span id="f01351c9df8c247a">BlogPostTests</span></a>
    {
        [<span class="i">Fact</span>]
        <b>public async</b> <a href="@1@System.Runtime/A.html#045a746eb48cbaa9" class="t t">Task</a> <a id="5359a61607fa152b" href="../../../R/../../0000000000.html" target="n" data-glyph="72,1" class="i method">ShouldListAllBlogs</a>()
        {
            <b>using</b> (<a href="../../Context/BlogContext.cs.html#4a57b6309abe12ff" class="k">var</a> <span id="r0 rd" class="r0 r">context</span> = <b>new</b> <a href="../../Context/BlogContext.cs.html#4a57b6309abe12ff" class="t constructor">BlogContext</a>())
            {
                <b>await</b> <span class="r0 r">context</span>.<a href="../../Context/BlogContext.cs.html#b8555cb060252fff" class="i method">InitializeAsync</a>();
 
                <b>var</b> <span id="r1 rd" class="r1 r">result</span> = <b>await</b> <span class="r0 r">context</span>
                    .<a href="../../Context/SiteContext.cs.html#06cb4389785d6417" class="i property">GraphQLClient</a>
                    .<a href="/OrchardCore.Apis.GraphQL.Client/A.html#abefefb3efdbad36" class="i property">Content</a>
                    .<a href="/OrchardCore.Apis.GraphQL.Client/A.html#98dcdcec2bd893a9" class="i method">Query</a>(<span class="s">&quot;Blog&quot;</span>, <span id="r2 rd" class="r2 r">builder</span> =&gt;
                    {
                        <span class="r2 r">builder</span>
                            .<a href="/OrchardCore.Apis.GraphQL.Client/A.html#f11cb42147974d64" class="i method">WithField</a>(<span class="s">&quot;contentItemId&quot;</span>);
                    });
 
                <span class="i">Assert</span>.<span class="i">Single</span>(<span class="r1 r">result</span>[<span class="s">&quot;data&quot;</span>][<span class="s">&quot;blog&quot;</span>].<span class="i">Children</span>()[<span class="s">&quot;contentItemId&quot;</span>]
                    .<span class="i">Where</span>(<span id="r3 rd" class="r3 r">b</span> =&gt; <span class="r3 r">b</span>.<span class="i">ToString</span>() == <span class="r0 r">context</span>.<a href="../../Context/BlogContext.cs.html#513cf7df8f601d64" class="i property">BlogContentItemId</a>));
            }
        }
 
        [<span class="i">Fact</span>]
        <b>public async</b> <a href="@1@System.Runtime/A.html#045a746eb48cbaa9" class="t t">Task</a> <a id="00ab3015d7961ab7" href="../../../R/../../0000000000.html" target="n" data-glyph="72,1" class="i method">ShouldQueryByBlogPostAutoroutePart</a>()
        {
            <b>using</b> (<a href="../../Context/BlogContext.cs.html#4a57b6309abe12ff" class="k">var</a> <span id="r4 rd" class="r4 r">context</span> = <b>new</b> <a href="../../Context/BlogContext.cs.html#4a57b6309abe12ff" class="t constructor">BlogContext</a>())
            {
                <b>await</b> <span class="r4 r">context</span>.<a href="../../Context/BlogContext.cs.html#b8555cb060252fff" class="i method">InitializeAsync</a>();
 
                <b>var</b> <span id="r5 rd" class="r5 r">blogPostContentItemId1</span> = <b>await</b> <span class="r4 r">context</span>
                    .<span class="i">CreateContentItem</span>(<span class="s">&quot;BlogPost&quot;</span>, <span id="r6 rd" class="r6 r">builder</span> =&gt;
                    {
                        <span class="r6 r">builder</span>
                            .<span class="i">DisplayText</span> = <span class="s">&quot;Some sorta blogpost!&quot;</span>;
 
                        <span class="r6 r">builder</span>
                            .<span class="i">Weld</span>(<b>new</b> <span class="i">AutoroutePart</span>
                            {
                                <span class="i">Path</span> = <span class="s">&quot;Path1&quot;</span>
                            });
 
                        <span class="r6 r">builder</span>
                            .<span class="i">Weld</span>(<b>new</b> <span class="i">ContainedPart</span>
                            {
                                <span class="i">ListContentItemId</span> = <span class="r4 r">context</span>.<a href="../../Context/BlogContext.cs.html#513cf7df8f601d64" class="i property">BlogContentItemId</a>
                            });
                    });
 
                <b>var</b> <span id="r7 rd" class="r7 r">blogPostContentItemId2</span> = <b>await</b> <span class="r4 r">context</span>
                    .<span class="i">CreateContentItem</span>(<span class="s">&quot;BlogPost&quot;</span>, <span id="r8 rd" class="r8 r">builder</span> =&gt;
                    {
                        <span class="r8 r">builder</span>
                            .<span class="i">DisplayText</span> = <span class="s">&quot;Some sorta other blogpost!&quot;</span>;
 
                        <span class="r8 r">builder</span>
                            .<span class="i">Weld</span>(<b>new</b> <span class="i">AutoroutePart</span>
                            {
                                <span class="i">Path</span> = <span class="s">&quot;Path2&quot;</span>
                            });
 
                        <span class="r8 r">builder</span>
                            .<span class="i">Weld</span>(<b>new</b> <span class="i">ContainedPart</span>
                            {
                                <span class="i">ListContentItemId</span> = <span class="r4 r">context</span>.<a href="../../Context/BlogContext.cs.html#513cf7df8f601d64" class="i property">BlogContentItemId</a>
                            });
                    });
 
                <b>var</b> <span id="r9 rd" class="r9 r">result</span> = <b>await</b> <span class="r4 r">context</span>
                    .<a href="../../Context/SiteContext.cs.html#06cb4389785d6417" class="i property">GraphQLClient</a>
                    .<a href="/OrchardCore.Apis.GraphQL.Client/A.html#abefefb3efdbad36" class="i property">Content</a>
                    .<a href="/OrchardCore.Apis.GraphQL.Client/A.html#98dcdcec2bd893a9" class="i method">Query</a>(<span class="s">&quot;BlogPost&quot;</span>, <span id="r10 rd" class="r10 r">builder</span> =&gt;
                    {
                        <span class="r10 r">builder</span>
                            .<a href="/OrchardCore.Apis.GraphQL.Client/A.html#48e3e8691ef81a8c" class="i method">WithQueryStringArgument</a>(<span class="s">&quot;where&quot;</span>, <span class="s">&quot;path&quot;</span>, <span class="s">&quot;Path1&quot;</span>);
 
                        <span class="r10 r">builder</span>
                            .<a href="/OrchardCore.Apis.GraphQL.Client/A.html#f11cb42147974d64" class="i method">WithField</a>(<span class="s">&quot;DisplayText&quot;</span>);
                    });
 
                <span class="i">Assert</span>.<span class="i">Equal</span>(
                    <span class="s">&quot;Some sorta blogpost!&quot;</span>,
                    <span class="r9 r">result</span>[<span class="s">&quot;data&quot;</span>][<span class="s">&quot;blogPost&quot;</span>][0][<span class="s">&quot;displayText&quot;</span>].<span class="i">ToString</span>());
            }
        }
 
        [<span class="i">Fact</span>]
        <b>public async</b> <a href="@1@System.Runtime/A.html#045a746eb48cbaa9" class="t t">Task</a> <a id="a5ac3b7d3cc0621e" href="../../../R/../../0000000000.html" target="n" data-glyph="72,1" class="i method">WhenThePartHasTheSameNameAsTheContentTypeShouldCollapseFieldsToContentType</a>()
        {
            <b>using</b> (<a href="../../Context/BlogContext.cs.html#4a57b6309abe12ff" class="k">var</a> <span id="r11 rd" class="r11 r">context</span> = <b>new</b> <a href="../../Context/BlogContext.cs.html#4a57b6309abe12ff" class="t constructor">BlogContext</a>())
            {
                <b>await</b> <span class="r11 r">context</span>.<a href="../../Context/BlogContext.cs.html#b8555cb060252fff" class="i method">InitializeAsync</a>();
 
                <b>var</b> <span id="r12 rd" class="r12 r">result</span> = <b>await</b> <span class="r11 r">context</span>
                    .<a href="../../Context/SiteContext.cs.html#06cb4389785d6417" class="i property">GraphQLClient</a>
                    .<a href="/OrchardCore.Apis.GraphQL.Client/A.html#abefefb3efdbad36" class="i property">Content</a>
                    .<a href="/OrchardCore.Apis.GraphQL.Client/A.html#98dcdcec2bd893a9" class="i method">Query</a>(<span class="s">&quot;BlogPost&quot;</span>, <span id="r13 rd" class="r13 r">builder</span> =&gt;
                    {
                        <span class="r13 r">builder</span>.<a href="/OrchardCore.Apis.GraphQL.Client/A.html#f11cb42147974d64" class="i method">WithField</a>(<span class="s">&quot;Subtitle&quot;</span>);
                    });
 
                <span class="i">Assert</span>.<span class="i">Equal</span>(
                    <span class="s">&quot;Problems look mighty small from 150 miles up&quot;</span>,
                    <span class="r12 r">result</span>[<span class="s">&quot;data&quot;</span>][<span class="s">&quot;blogPost&quot;</span>][0][<span class="s">&quot;subtitle&quot;</span>].<span class="i">ToString</span>());
            }
        }
 
        [<span class="i">Fact</span>]
        <b>public async</b> <a href="@1@System.Runtime/A.html#045a746eb48cbaa9" class="t t">Task</a> <a id="4b740213998e7fdb" href="../../../R/../../0000000000.html" target="n" data-glyph="72,1" class="i method">WhenCreatingABlogPostShouldBeAbleToPopulateField</a>()
        {
            <b>using</b> (<a href="../../Context/BlogContext.cs.html#4a57b6309abe12ff" class="k">var</a> <span id="r14 rd" class="r14 r">context</span> = <b>new</b> <a href="../../Context/BlogContext.cs.html#4a57b6309abe12ff" class="t constructor">BlogContext</a>())
            {
                <b>await</b> <span class="r14 r">context</span>.<a href="../../Context/BlogContext.cs.html#b8555cb060252fff" class="i method">InitializeAsync</a>();
 
                <b>var</b> <span id="r15 rd" class="r15 r">blogPostContentItemId</span> = <b>await</b> <span class="r14 r">context</span>
                    .<span class="i">CreateContentItem</span>(<span class="s">&quot;BlogPost&quot;</span>, <span id="r16 rd" class="r16 r">builder</span> =&gt;
                    {
                        <span class="r16 r">builder</span>
                            .<span class="i">DisplayText</span> = <span class="s">&quot;Some sorta blogpost!&quot;</span>;
 
                        <span class="r16 r">builder</span>
                            .<span class="i">Weld</span>(<span class="s">&quot;BlogPost&quot;</span>, <b>new</b> <span class="i">ContentPart</span>());
 
                        <span class="r16 r">builder</span>
                            .<span class="i">Alter</span>&lt;<span class="i">ContentPart</span>&gt;(<span class="s">&quot;BlogPost&quot;</span>, (<span id="r17 rd" class="r17 r">cp</span>) =&gt;
                            {
                                <span class="r17 r">cp</span>.<span class="i">Weld</span>(<span class="s">&quot;Subtitle&quot;</span>, <b>new</b> <span class="i">TextField</span>());
 
                                <span class="r17 r">cp</span>.<span class="i">Alter</span>&lt;<span class="i">TextField</span>&gt;(<span class="s">&quot;Subtitle&quot;</span>, <span id="r18 rd" class="r18 r">tf</span> =&gt;
                                {
                                    <span class="r18 r">tf</span>.<span class="i">Text</span> = <span class="s">&quot;Hey - Is this working!?!?!?!?&quot;</span>;
                                });
                            });
 
                        <span class="r16 r">builder</span>
                            .<span class="i">Weld</span>(<b>new</b> <span class="i">ContainedPart</span>
                            {
                                <span class="i">ListContentItemId</span> = <span class="r14 r">context</span>.<a href="../../Context/BlogContext.cs.html#513cf7df8f601d64" class="i property">BlogContentItemId</a>
                            });
                    });
 
                <b>var</b> <span id="r19 rd" class="r19 r">result</span> = <b>await</b> <span class="r14 r">context</span>
                    .<a href="../../Context/SiteContext.cs.html#06cb4389785d6417" class="i property">GraphQLClient</a>
                    .<a href="/OrchardCore.Apis.GraphQL.Client/A.html#abefefb3efdbad36" class="i property">Content</a>
                    .<a href="/OrchardCore.Apis.GraphQL.Client/A.html#98dcdcec2bd893a9" class="i method">Query</a>(<span class="s">&quot;BlogPost&quot;</span>, <span id="r20 rd" class="r20 r">builder</span> =&gt;
                    {
                        <span class="r20 r">builder</span>
                            .<span class="i">WithQueryStringArgument</span>(<span class="s">&quot;where&quot;</span>, <span class="s">&quot;ContentItemId&quot;</span>, <span class="r15 r">blogPostContentItemId</span>);
 
                        <span class="r20 r">builder</span>
                            .<a href="/OrchardCore.Apis.GraphQL.Client/A.html#f11cb42147974d64" class="i method">WithField</a>(<span class="s">&quot;Subtitle&quot;</span>);
                    });
 
                <span class="i">Assert</span>.<span class="i">Equal</span>(
                    <span class="s">&quot;Hey - Is this working!?!?!?!?&quot;</span>,
                    <span class="r19 r">result</span>[<span class="s">&quot;data&quot;</span>][<span class="s">&quot;blogPost&quot;</span>][0][<span class="s">&quot;subtitle&quot;</span>].<span class="i">ToString</span>());
            }
        }
 
        [<span class="i">Fact</span>]
        <b>public async</b> <a href="@1@System.Runtime/A.html#045a746eb48cbaa9" class="t t">Task</a> <a id="e619df3fc2d81124" href="../../../R/../../0000000000.html" target="n" data-glyph="72,1" class="i method">ShouldQueryByStatus</a>()
        {
            <b>using</b> (<a href="../../Context/BlogContext.cs.html#4a57b6309abe12ff" class="k">var</a> <span id="r21 rd" class="r21 r">context</span> = <b>new</b> <a href="../../Context/BlogContext.cs.html#4a57b6309abe12ff" class="t constructor">BlogContext</a>())
            {
                <b>await</b> <span class="r21 r">context</span>.<a href="../../Context/BlogContext.cs.html#b8555cb060252fff" class="i method">InitializeAsync</a>();
 
                <b>var</b> <span id="r22 rd" class="r22 r">draft</span> = <b>await</b> <span class="r21 r">context</span>
                    .<span class="i">CreateContentItem</span>(<span class="s">&quot;BlogPost&quot;</span>, <span id="r23 rd" class="r23 r">builder</span> =&gt;
                    {
                        <span class="r23 r">builder</span>.<span class="i">DisplayText</span> = <span class="s">&quot;Draft blog post&quot;</span>;
                        <span class="r23 r">builder</span>.<span class="i">Published</span> = <b>false</b>;
                        <span class="r23 r">builder</span>.<span class="i">Latest</span> = <b>true</b>;
 
                        <span class="r23 r">builder</span>
                            .<span class="i">Weld</span>(<b>new</b> <span class="i">ContainedPart</span>
                            {
                                <span class="i">ListContentItemId</span> = <span class="r21 r">context</span>.<a href="../../Context/BlogContext.cs.html#513cf7df8f601d64" class="i property">BlogContentItemId</a>
                            });
                    }, <span class="i">draft</span>: <b>true</b>);
 
                <b>var</b> <span id="r24 rd" class="r24 r">result</span> = <b>await</b> <span class="r21 r">context</span>.<a href="../../Context/SiteContext.cs.html#06cb4389785d6417" class="i property">GraphQLClient</a>.<a href="/OrchardCore.Apis.GraphQL.Client/A.html#abefefb3efdbad36" class="i property">Content</a>
                    .<a href="/OrchardCore.Apis.GraphQL.Client/A.html#7ed6ab6988f019a7" class="i method">Query</a>(<span class="s">&quot;blogPost(status: PUBLISHED) { displayText, published }&quot;</span>);
 
                <span class="i">Assert</span>.<span class="i">Single</span>(<span class="r24 r">result</span>[<span class="s">&quot;data&quot;</span>][<span class="s">&quot;blogPost&quot;</span>]);
                <span class="i">Assert</span>.<span class="i">Equal</span>(<b>true</b>, <span class="r24 r">result</span>[<span class="s">&quot;data&quot;</span>][<span class="s">&quot;blogPost&quot;</span>][0][<span class="s">&quot;published&quot;</span>]);
 
                <span class="r24 r">result</span> = <b>await</b> <span class="r21 r">context</span>.<a href="../../Context/SiteContext.cs.html#06cb4389785d6417" class="i property">GraphQLClient</a>.<a href="/OrchardCore.Apis.GraphQL.Client/A.html#abefefb3efdbad36" class="i property">Content</a>
                    .<a href="/OrchardCore.Apis.GraphQL.Client/A.html#7ed6ab6988f019a7" class="i method">Query</a>(<span class="s">&quot;blogPost(status: DRAFT) { displayText, published }&quot;</span>);
 
                <span class="i">Assert</span>.<span class="i">Single</span>(<span class="r24 r">result</span>[<span class="s">&quot;data&quot;</span>][<span class="s">&quot;blogPost&quot;</span>]);
                <span class="i">Assert</span>.<span class="i">Equal</span>(<b>false</b>, <span class="r24 r">result</span>[<span class="s">&quot;data&quot;</span>][<span class="s">&quot;blogPost&quot;</span>][0][<span class="s">&quot;published&quot;</span>]);
 
                <span class="r24 r">result</span> = <b>await</b> <span class="r21 r">context</span>.<a href="../../Context/SiteContext.cs.html#06cb4389785d6417" class="i property">GraphQLClient</a>.<a href="/OrchardCore.Apis.GraphQL.Client/A.html#abefefb3efdbad36" class="i property">Content</a>
                    .<a href="/OrchardCore.Apis.GraphQL.Client/A.html#7ed6ab6988f019a7" class="i method">Query</a>(<span class="s">&quot;blogPost(status: LATEST) { displayText, published }&quot;</span>);
 
                <span class="i">Assert</span>.<span class="i">Equal</span>(2, <span class="r24 r">result</span>[<span class="s">&quot;data&quot;</span>][<span class="s">&quot;blogPost&quot;</span>].<span class="i">Count</span>());
            }
        }
 
        [<span class="i">Fact</span>]
        <b>public async</b> <a href="@1@System.Runtime/A.html#045a746eb48cbaa9" class="t t">Task</a> <a id="dfbe1d82c71d02b1" href="../../../R/../../0000000000.html" target="n" data-glyph="72,1" class="i method">ShouldNotBeAbleToExecuteAnyQueriesWithoutPermission</a>()
        {
            <b>using</b> <a href="../../Context/SiteContext.cs.html#cc2a047ff23fb874" class="k">var</a> <span id="r25 rd" class="r25 r">context</span> = <b>new</b> <a href="../../Context/SiteContext.cs.html#cc2a047ff23fb874" class="t constructor">SiteContext</a>()
                .<a href="../../Context/SiteContext.cs.html#fa87041df8a43d72" class="i method">WithPermissionsContext</a>(<b>new</b> <a href="../../Context/AuthenticationContext.cs.html#63987e9ae4c41091" class="t constructor">PermissionsContext</a> { <a href="../../Context/AuthenticationContext.cs.html#70786fc0f9963548" class="i property">UsePermissionsContext</a> = <b>true</b> });
 
            <b>await</b> <span class="r25 r">context</span>.<a href="../../Context/SiteContext.cs.html#b2d36471a22dff42" class="i method">InitializeAsync</a>();
 
            <b>var</b> <span id="r26 rd" class="r26 r">response</span> = <b>await</b> <span class="r25 r">context</span>.<a href="../../Context/SiteContext.cs.html#06cb4389785d6417" class="i property">GraphQLClient</a>.<a href="/OrchardCore.Apis.GraphQL.Client/A.html#9cbd177dbed6cb99" class="i property">Client</a>.<span class="i method">GetAsync</span>(<span class="s">&quot;api/graphql&quot;</span>);
            <span class="i">Assert</span>.<span class="i">Equal</span>(<span class="i n">System</span>.<span class="i n">Net</span>.<span class="t t">HttpStatusCode</span>.<span class="i field">Unauthorized</span>, <span class="r26 r">response</span>.<span class="i property">StatusCode</span>);
        }
 
        [<span class="i">Fact</span>]
        <b>public async</b> <a href="@1@System.Runtime/A.html#045a746eb48cbaa9" class="t t">Task</a> <a id="c5d76202f51f85c7" href="../../../R/../../0000000000.html" target="n" data-glyph="72,1" class="i method">ShouldReturnBlogsWithViewBlogContentPermission</a>()
        {
            <b>using</b> <a href="../../Context/SiteContext.cs.html#cc2a047ff23fb874" class="k">var</a> <span id="r27 rd" class="r27 r">context</span> = <b>new</b> <a href="../../Context/SiteContext.cs.html#cc2a047ff23fb874" class="t constructor">SiteContext</a>()
                .<a href="../../Context/SiteContext.cs.html#fa87041df8a43d72" class="i method">WithPermissionsContext</a>(<b>new</b> <a href="../../Context/AuthenticationContext.cs.html#63987e9ae4c41091" class="t constructor">PermissionsContext</a>
                {
                    <a href="../../Context/AuthenticationContext.cs.html#70786fc0f9963548" class="i property">UsePermissionsContext</a> = <b>true</b>,
                    <a href="../../Context/AuthenticationContext.cs.html#9e06b4123787a4f4" class="i property">AuthorizedPermissions</a> = <b>new</b>[]
                    {
                        <span class="i n">GraphQLApi</span>.<span class="i">Permissions</span>.<span class="i">ExecuteGraphQL</span>,
                        <span class="i">Contents</span>.<span class="i">Permissions</span>.<span class="i">ViewContent</span>
                    }
                });
 
            <b>await</b> <span class="r27 r">context</span>.<a href="../../Context/SiteContext.cs.html#b2d36471a22dff42" class="i method">InitializeAsync</a>();
 
            <b>var</b> <span id="r28 rd" class="r28 r">result</span> = <b>await</b> <span class="r27 r">context</span>.<a href="../../Context/SiteContext.cs.html#06cb4389785d6417" class="i property">GraphQLClient</a>.<a href="/OrchardCore.Apis.GraphQL.Client/A.html#abefefb3efdbad36" class="i property">Content</a>
                .<a href="/OrchardCore.Apis.GraphQL.Client/A.html#98dcdcec2bd893a9" class="i method">Query</a>(<span class="s">&quot;blog&quot;</span>, <span id="r29 rd" class="r29 r">builder</span> =&gt;
                {
                    <span class="r29 r">builder</span>.<a href="/OrchardCore.Apis.GraphQL.Client/A.html#f11cb42147974d64" class="i method">WithField</a>(<span class="s">&quot;contentItemId&quot;</span>);
                });
 
            <span class="i">Assert</span>.<span class="i">NotEmpty</span>(<span class="r28 r">result</span>[<span class="s">&quot;data&quot;</span>][<span class="s">&quot;blog&quot;</span>]);
        }
 
        [<span class="i">Fact</span>]
        <b>public async</b> <a href="@1@System.Runtime/A.html#045a746eb48cbaa9" class="t t">Task</a> <a id="fa2d7d6053d3fba1" href="../../../R/../../0000000000.html" target="n" data-glyph="72,1" class="i method">ShouldNotReturnBlogsWithoutViewBlogContentPermission</a>()
        {
            <b>using</b> <a href="../../Context/SiteContext.cs.html#cc2a047ff23fb874" class="k">var</a> <span id="r30 rd" class="r30 r">context</span> = <b>new</b> <a href="../../Context/SiteContext.cs.html#cc2a047ff23fb874" class="t constructor">SiteContext</a>()
                .<a href="../../Context/SiteContext.cs.html#fa87041df8a43d72" class="i method">WithPermissionsContext</a>(<b>new</b> <a href="../../Context/AuthenticationContext.cs.html#63987e9ae4c41091" class="t constructor">PermissionsContext</a>
                {
                    <a href="../../Context/AuthenticationContext.cs.html#70786fc0f9963548" class="i property">UsePermissionsContext</a> = <b>true</b>,
                    <a href="../../Context/AuthenticationContext.cs.html#9e06b4123787a4f4" class="i property">AuthorizedPermissions</a> = <b>new</b>[]
                    {
                        <span class="i n">GraphQLApi</span>.<span class="i">Permissions</span>.<span class="i">ExecuteGraphQL</span>
                    }
                });
 
            <b>await</b> <span class="r30 r">context</span>.<a href="../../Context/SiteContext.cs.html#b2d36471a22dff42" class="i method">InitializeAsync</a>();
 
            <b>var</b> <span id="r31 rd" class="r31 r">result</span> = <b>await</b> <span class="r30 r">context</span>.<a href="../../Context/SiteContext.cs.html#06cb4389785d6417" class="i property">GraphQLClient</a>.<a href="/OrchardCore.Apis.GraphQL.Client/A.html#abefefb3efdbad36" class="i property">Content</a>
                .<a href="/OrchardCore.Apis.GraphQL.Client/A.html#98dcdcec2bd893a9" class="i method">Query</a>(<span class="s">&quot;blog&quot;</span>, <span id="r32 rd" class="r32 r">builder</span> =&gt;
                {
                    <span class="r32 r">builder</span>.<a href="/OrchardCore.Apis.GraphQL.Client/A.html#f11cb42147974d64" class="i method">WithField</a>(<span class="s">&quot;contentItemId&quot;</span>);
                });
 
            <span class="i">Assert</span>.<span class="i">Equal</span>(<span class="i n">GraphQLApi</span>.<span class="i">ValidationRules</span>.<span class="i">RequiresPermissionValidationRule</span>.<span class="i">ErrorCode</span>, <span class="r31 r">result</span>[<span class="s">&quot;errors&quot;</span>][0][<span class="s">&quot;extensions&quot;</span>][<span class="s">&quot;code&quot;</span>]);
        }
    }
}
</pre></td></tr></table></div></body></html>
