<!DOCTYPE html>
<html><head><title>OpenIdServerConfiguration.cs</title><link rel="stylesheet" href="../../styles.css"><script src="../../scripts.js"></script></head>
<body class="cB" onload="i(214);"><div class="dH">
<table style="width: 100%">
<tr><td>File: <a id="filePath" class="blueLink" href="/#OrchardCore.OpenId/Configuration/OpenIdServerConfiguration.cs" target="_top">Configuration\OpenIdServerConfiguration.cs</a><br/></td><td></td></tr>
<tr><td>Project: <a id="projectPath" class="blueLink" href="/#OrchardCore.OpenId" target="_top">src\OrchardCore.Modules\OrchardCore.OpenId\OrchardCore.OpenId.csproj</a> (OrchardCore.OpenId)</td><td></td></tr>
</table>
</div>
<div class="cz"><table class="tb" cellpadding="0" cellspacing="0"><tr><td valign="top" align="right"><pre id="ln"></pre></td><td valign="top" align="left"><pre id="code">
<b>using</b> <span class="i n">System</span>;
<b>using</b> <span class="i n">System</span>.<span class="i n">ComponentModel</span>.<span class="i n">DataAnnotations</span>;
<b>using</b> <span class="i n">System</span>.<span class="i n">Diagnostics</span>;
<b>using</b> <span class="i n">System</span>.<span class="i n">Linq</span>;
<b>using</b> <span class="i n">System</span>.<span class="i n">Threading</span>.<span class="i n">Tasks</span>;
<b>using</b> <span class="i n">Microsoft</span>.<span class="i n">AspNetCore</span>.<span class="i n">Authentication</span>;
<b>using</b> <span class="i n">Microsoft</span>.<span class="i n">Extensions</span>.<span class="i n">Logging</span>;
<b>using</b> <span class="i n">Microsoft</span>.<span class="i n">Extensions</span>.<span class="i n">Options</span>;
<b>using</b> <span class="i n">Microsoft</span>.<span class="i">IdentityModel</span>.<span class="i">Tokens</span>;
<b>using</b> <span class="i">OpenIddict</span>.<span class="i">Server</span>;
<b>using</b> <span class="i">OpenIddict</span>.<span class="i">Server</span>.<span class="i">AspNetCore</span>;
<b>using</b> <span class="i">OpenIddict</span>.<span class="i">Server</span>.<span class="i">DataProtection</span>;
<b>using</b> <span class="i n">OrchardCore</span>.<span class="i">Environment</span>.<span class="i">Shell</span>;
<b>using</b> <span class="i n">OrchardCore</span>.<span class="i">Environment</span>.<span class="i">Shell</span>.<span class="i">Models</span>;
<b>using</b> <span class="i n">OrchardCore</span>.<span class="i">Modules</span>;
<b>using</b> <span class="i n">OrchardCore</span>.<span class="i n">OpenId</span>.<span class="i n">Services</span>;
<b>using</b> <span class="i n">OrchardCore</span>.<span class="i n">OpenId</span>.<span class="i n">Settings</span>;
<b>using static</b> <span class="i">OpenIddict</span>.<span class="i">Abstractions</span>.<span class="i">OpenIddictConstants</span>;
 
<b>namespace</b> <span class="i n">OrchardCore</span>.<span class="i n">OpenId</span>.<span class="i n">Configuration</span>
{
    [<span class="i">Feature</span>(<a href="/OrchardCore.OpenId.Core/A.html#fccd8503b7a327a6" class="t t">OpenIdConstants</a>.<a href="/OrchardCore.OpenId.Core/A.html#b0e247f8196e91a5" class="t t">Features</a>.<a href="/OrchardCore.OpenId.Core/A.html#95bdd03828e4cce9" class="i field">Server</a>)]
    <b>public class</b> <a id="b4e4525fed93418f" href="../R/b4e4525fed93418f.html" target="n" data-glyph="0,0" class="t t">OpenIdServerConfiguration</a> : <span class="t t">IConfigureOptions</span>&lt;<span class="t t">AuthenticationOptions</span>&gt;,
        <span class="t t">IConfigureOptions</span>&lt;<span class="i">OpenIddictServerOptions</span>&gt;,
        <span class="t t">IConfigureOptions</span>&lt;<span class="i">OpenIddictServerDataProtectionOptions</span>&gt;,
        <span class="t t">IConfigureNamedOptions</span>&lt;<span class="i">OpenIddictServerAspNetCoreOptions</span>&gt;
    {
        <b>private readonly</b> <a href="../Services/IOpenIdServerService.cs.html#16b68e76cf5b848a" class="t t">IOpenIdServerService</a> <a id="2bf2cb94124ad6f7" href="../R/2bf2cb94124ad6f7.html" target="n" data-glyph="46,1" class="i field">_serverService</a>;
        <b>private readonly</b> <span class="i">ShellSettings</span> <a id="c39a41795385adf0" href="../R/c39a41795385adf0.html" target="n" data-glyph="46,1" class="i field">_shellSettings</a>;
        <b>private readonly</b> <span class="t t">ILogger</span> <a id="a5859c3c5e3f54fc" href="../R/a5859c3c5e3f54fc.html" target="n" data-glyph="46,1" class="i field">_logger</a>;
 
        <b>public</b> <a id="e5a7afa1887d5c03" href="../R/../../0000000000.html" target="n" data-glyph="72,1" class="t constructor">OpenIdServerConfiguration</a>(
            <a href="../Services/IOpenIdServerService.cs.html#16b68e76cf5b848a" class="t t">IOpenIdServerService</a> <span id="r0 rd" class="r0 r">serverService</span>,
            <span class="i">ShellSettings</span> <span id="r1 rd" class="r1 r">shellSettings</span>,
            <span class="t t">ILogger</span>&lt;<a href="#b4e4525fed93418f" class="t t">OpenIdServerConfiguration</a>&gt; <span id="r2 rd" class="r2 r">logger</span>)
        {
            <a href="#2bf2cb94124ad6f7" class="i field">_serverService</a> = <span class="r0 r">serverService</span>;
            <a href="#c39a41795385adf0" class="i field">_shellSettings</a> = <span class="r1 r">shellSettings</span>;
            <a href="#a5859c3c5e3f54fc" class="i field">_logger</a> = <span class="r2 r">logger</span>;
        }
 
        <b>public void</b> <a id="22b672b07775cb9f" href="../R/22b672b07775cb9f.html" target="n" data-glyph="72,1" class="i method">Configure</a>(<span class="t t">AuthenticationOptions</span> <span id="r3 rd" class="r3 r">options</span>)
        {
            <a href="../Settings/OpenIdServerSettings.cs.html#608b0079a4b49cf3" class="k">var</a> <span id="r4 rd" class="r4 r">settings</span> = <a href="#63683cfa6cf72748" class="i method">GetServerSettingsAsync</a>().<a href="@1@System.Runtime/A.html#e1d639f68b66715a" class="i method">GetAwaiter</a>().<a href="@1@System.Runtime/A.html#c2597ba59f71d619" class="i method">GetResult</a>();
            <b>if</b> (<span class="r4 r">settings</span> == <b>null</b>)
            {
                <b>return</b>;
            }
 
            <span class="r3 r">options</span>.<span class="i">AddScheme</span>&lt;<span class="i">OpenIddictServerAspNetCoreHandler</span>&gt;(
                <span class="i">OpenIddictServerAspNetCoreDefaults</span>.<span class="i">AuthenticationScheme</span>, <span class="i">displayName</span>: <b>null</b>);
        }
 
        <b>public void</b> <a id="f10cd3084e1d90f8" href="../R/f10cd3084e1d90f8.html" target="n" data-glyph="72,1" class="i method">Configure</a>(<span class="i">OpenIddictServerOptions</span> <span id="r5 rd" class="r5 r">options</span>)
        {
            <a href="../Settings/OpenIdServerSettings.cs.html#608b0079a4b49cf3" class="k">var</a> <span id="r6 rd" class="r6 r">settings</span> = <a href="#63683cfa6cf72748" class="i method">GetServerSettingsAsync</a>().<a href="@1@System.Runtime/A.html#e1d639f68b66715a" class="i method">GetAwaiter</a>().<a href="@1@System.Runtime/A.html#c2597ba59f71d619" class="i method">GetResult</a>();
            <b>if</b> (<span class="r6 r">settings</span> == <b>null</b>)
            {
                <b>return</b>;
            }
 
            <span class="r5 r">options</span>.<span class="i">Issuer</span> = <span class="r6 r">settings</span>.<a href="../Settings/OpenIdServerSettings.cs.html#f4c4ce4660dd0c8e" class="i property">Authority</a>;
            <span class="r5 r">options</span>.<span class="i">DisableAccessTokenEncryption</span> = <span class="r6 r">settings</span>.<a href="../Settings/OpenIdServerSettings.cs.html#ba6125d66b1cadbe" class="i property">DisableAccessTokenEncryption</a>;
            <span class="r5 r">options</span>.<span class="i">DisableRollingRefreshTokens</span> = <span class="r6 r">settings</span>.<a href="../Settings/OpenIdServerSettings.cs.html#54f12b790582e308" class="i property">DisableRollingRefreshTokens</a>;
            <span class="r5 r">options</span>.<span class="i">UseReferenceAccessTokens</span> = <span class="r6 r">settings</span>.<a href="../Settings/OpenIdServerSettings.cs.html#a80acda7be191950" class="i property">UseReferenceAccessTokens</a>;
 
            <b>foreach</b> (<b>var</b> <span id="r7 rd" class="r7 r">key</span> <b>in</b> <a href="#2bf2cb94124ad6f7" class="i field">_serverService</a>.<a href="../Services/IOpenIdServerService.cs.html#8b2d3f3a0bfb0a9c" class="i method">GetEncryptionKeysAsync</a>().<a href="@1@System.Runtime/A.html#e1d639f68b66715a" class="i method">GetAwaiter</a>().<a href="@1@System.Runtime/A.html#c2597ba59f71d619" class="i method">GetResult</a>())
            {
                <span class="r5 r">options</span>.<span class="i">EncryptionCredentials</span>.<span class="i">Add</span>(<b>new</b> <span class="i">EncryptingCredentials</span>(<span class="r7 r">key</span>,
                    <span class="i">SecurityAlgorithms</span>.<span class="i">RsaOAEP</span>, <span class="i">SecurityAlgorithms</span>.<span class="i">Aes256CbcHmacSha512</span>));
            }
 
            <b>foreach</b> (<b>var</b> <span id="r8 rd" class="r8 r">key</span> <b>in</b> <a href="#2bf2cb94124ad6f7" class="i field">_serverService</a>.<a href="../Services/IOpenIdServerService.cs.html#d7cbba666f35f0a0" class="i method">GetSigningKeysAsync</a>().<a href="@1@System.Runtime/A.html#e1d639f68b66715a" class="i method">GetAwaiter</a>().<a href="@1@System.Runtime/A.html#c2597ba59f71d619" class="i method">GetResult</a>())
            {
                <span class="r5 r">options</span>.<span class="i">SigningCredentials</span>.<span class="i">Add</span>(<b>new</b> <span class="i">SigningCredentials</span>(<span class="r8 r">key</span>, <span class="i">SecurityAlgorithms</span>.<span class="i">RsaSha256</span>));
            }
 
            <b>if</b> (<span class="r6 r">settings</span>.<a href="../Settings/OpenIdServerSettings.cs.html#47949ff3ac5eacbc" class="i property">AuthorizationEndpointPath</a>.<span class="i property">HasValue</span>)
            {
                <span class="r5 r">options</span>.<span class="i">AuthorizationEndpointUris</span>.<span class="i">Add</span>(<b>new</b> <a href="@1@System.Runtime/A.html#d9fc45d783ee73ff" class="t constructor">Uri</a>(<span class="r6 r">settings</span>.<a href="../Settings/OpenIdServerSettings.cs.html#47949ff3ac5eacbc" class="i property">AuthorizationEndpointPath</a>.<span class="i property">Value</span>, <a href="@1@System.Runtime/A.html#ac43655101ad74be" class="t t">UriKind</a>.<a href="@1@System.Runtime/A.html#c6d780fc34e3f702" class="i field">Relative</a>));
            }
            <b>if</b> (<span class="r6 r">settings</span>.<a href="../Settings/OpenIdServerSettings.cs.html#284635bce667cd71" class="i property">LogoutEndpointPath</a>.<span class="i property">HasValue</span>)
            {
                <span class="r5 r">options</span>.<span class="i">LogoutEndpointUris</span>.<span class="i">Add</span>(<b>new</b> <a href="@1@System.Runtime/A.html#d9fc45d783ee73ff" class="t constructor">Uri</a>(<span class="r6 r">settings</span>.<a href="../Settings/OpenIdServerSettings.cs.html#284635bce667cd71" class="i property">LogoutEndpointPath</a>.<span class="i property">Value</span>, <a href="@1@System.Runtime/A.html#ac43655101ad74be" class="t t">UriKind</a>.<a href="@1@System.Runtime/A.html#c6d780fc34e3f702" class="i field">Relative</a>));
            }
            <b>if</b> (<span class="r6 r">settings</span>.<a href="../Settings/OpenIdServerSettings.cs.html#9af55160af9d3aef" class="i property">TokenEndpointPath</a>.<span class="i property">HasValue</span>)
            {
                <span class="r5 r">options</span>.<span class="i">TokenEndpointUris</span>.<span class="i">Add</span>(<b>new</b> <a href="@1@System.Runtime/A.html#d9fc45d783ee73ff" class="t constructor">Uri</a>(<span class="r6 r">settings</span>.<a href="../Settings/OpenIdServerSettings.cs.html#9af55160af9d3aef" class="i property">TokenEndpointPath</a>.<span class="i property">Value</span>, <a href="@1@System.Runtime/A.html#ac43655101ad74be" class="t t">UriKind</a>.<a href="@1@System.Runtime/A.html#c6d780fc34e3f702" class="i field">Relative</a>));
            }
            <b>if</b> (<span class="r6 r">settings</span>.<a href="../Settings/OpenIdServerSettings.cs.html#dac7bdc2fec4c46e" class="i property">UserinfoEndpointPath</a>.<span class="i property">HasValue</span>)
            {
                <span class="r5 r">options</span>.<span class="i">UserinfoEndpointUris</span>.<span class="i">Add</span>(<b>new</b> <a href="@1@System.Runtime/A.html#d9fc45d783ee73ff" class="t constructor">Uri</a>(<span class="r6 r">settings</span>.<a href="../Settings/OpenIdServerSettings.cs.html#dac7bdc2fec4c46e" class="i property">UserinfoEndpointPath</a>.<span class="i property">Value</span>, <a href="@1@System.Runtime/A.html#ac43655101ad74be" class="t t">UriKind</a>.<a href="@1@System.Runtime/A.html#c6d780fc34e3f702" class="i field">Relative</a>));
            }
 
            <span class="c">// For now, response types and response modes are not directly</span>
            <span class="c">// configurable and are inferred from the selected flows.</span>
            <b>if</b> (<span class="r6 r">settings</span>.<a href="../Settings/OpenIdServerSettings.cs.html#031dec3a2c57d216" class="i property">AllowAuthorizationCodeFlow</a>)
            {
                <span class="r5 r">options</span>.<span class="i">CodeChallengeMethods</span>.<span class="i">Add</span>(<span class="i">CodeChallengeMethods</span>.<span class="i">Sha256</span>);
 
                <span class="r5 r">options</span>.<span class="i">GrantTypes</span>.<span class="i">Add</span>(<span class="i">GrantTypes</span>.<span class="i">AuthorizationCode</span>);
 
                <span class="r5 r">options</span>.<span class="i">ResponseModes</span>.<span class="i">Add</span>(<span class="i">ResponseModes</span>.<span class="i">FormPost</span>);
                <span class="r5 r">options</span>.<span class="i">ResponseModes</span>.<span class="i">Add</span>(<span class="i">ResponseModes</span>.<span class="i">Fragment</span>);
                <span class="r5 r">options</span>.<span class="i">ResponseModes</span>.<span class="i">Add</span>(<span class="i">ResponseModes</span>.<span class="i">Query</span>);
 
                <span class="r5 r">options</span>.<span class="i">ResponseTypes</span>.<span class="i">Add</span>(<span class="i">ResponseTypes</span>.<span class="i">Code</span>);
            }
            <b>if</b> (<span class="r6 r">settings</span>.<a href="../Settings/OpenIdServerSettings.cs.html#61b3c5f821746d44" class="i property">AllowClientCredentialsFlow</a>)
            {
                <span class="r5 r">options</span>.<span class="i">GrantTypes</span>.<span class="i">Add</span>(<span class="i">GrantTypes</span>.<span class="i">ClientCredentials</span>);
            }
            <b>if</b> (<span class="r6 r">settings</span>.<a href="../Settings/OpenIdServerSettings.cs.html#1639a4c31b41406e" class="i property">AllowHybridFlow</a>)
            {
                <span class="r5 r">options</span>.<span class="i">CodeChallengeMethods</span>.<span class="i">Add</span>(<span class="i">CodeChallengeMethods</span>.<span class="i">Sha256</span>);
 
                <span class="r5 r">options</span>.<span class="i">GrantTypes</span>.<span class="i">Add</span>(<span class="i">GrantTypes</span>.<span class="i">AuthorizationCode</span>);
                <span class="r5 r">options</span>.<span class="i">GrantTypes</span>.<span class="i">Add</span>(<span class="i">GrantTypes</span>.<span class="i">Implicit</span>);
 
                <span class="r5 r">options</span>.<span class="i">ResponseModes</span>.<span class="i">Add</span>(<span class="i">ResponseModes</span>.<span class="i">FormPost</span>);
                <span class="r5 r">options</span>.<span class="i">ResponseModes</span>.<span class="i">Add</span>(<span class="i">ResponseModes</span>.<span class="i">Fragment</span>);
 
                <span class="r5 r">options</span>.<span class="i">ResponseTypes</span>.<span class="i">Add</span>(<span class="i">ResponseTypes</span>.<span class="i">Code</span> + <span class="s">&#39; &#39;</span> + <span class="i">ResponseTypes</span>.<span class="i">IdToken</span>);
                <span class="r5 r">options</span>.<span class="i">ResponseTypes</span>.<span class="i">Add</span>(<span class="i">ResponseTypes</span>.<span class="i">Code</span> + <span class="s">&#39; &#39;</span> + <span class="i">ResponseTypes</span>.<span class="i">IdToken</span> + <span class="s">&#39; &#39;</span> + <span class="i">ResponseTypes</span>.<span class="i">Token</span>);
                <span class="r5 r">options</span>.<span class="i">ResponseTypes</span>.<span class="i">Add</span>(<span class="i">ResponseTypes</span>.<span class="i">Code</span> + <span class="s">&#39; &#39;</span> + <span class="i">ResponseTypes</span>.<span class="i">Token</span>);
            }
            <b>if</b> (<span class="r6 r">settings</span>.<a href="../Settings/OpenIdServerSettings.cs.html#13451acf03d93afd" class="i property">AllowImplicitFlow</a>)
            {
                <span class="r5 r">options</span>.<span class="i">GrantTypes</span>.<span class="i">Add</span>(<span class="i">GrantTypes</span>.<span class="i">Implicit</span>);
 
                <span class="r5 r">options</span>.<span class="i">ResponseModes</span>.<span class="i">Add</span>(<span class="i">ResponseModes</span>.<span class="i">FormPost</span>);
                <span class="r5 r">options</span>.<span class="i">ResponseModes</span>.<span class="i">Add</span>(<span class="i">ResponseModes</span>.<span class="i">Fragment</span>);
 
                <span class="r5 r">options</span>.<span class="i">ResponseTypes</span>.<span class="i">Add</span>(<span class="i">ResponseTypes</span>.<span class="i">IdToken</span>);
                <span class="r5 r">options</span>.<span class="i">ResponseTypes</span>.<span class="i">Add</span>(<span class="i">ResponseTypes</span>.<span class="i">IdToken</span> + <span class="s">&#39; &#39;</span> + <span class="i">ResponseTypes</span>.<span class="i">Token</span>);
                <span class="r5 r">options</span>.<span class="i">ResponseTypes</span>.<span class="i">Add</span>(<span class="i">ResponseTypes</span>.<span class="i">Token</span>);
            }
            <b>if</b> (<span class="r6 r">settings</span>.<a href="../Settings/OpenIdServerSettings.cs.html#c6af4c0e4db847bd" class="i property">AllowPasswordFlow</a>)
            {
                <span class="r5 r">options</span>.<span class="i">GrantTypes</span>.<span class="i">Add</span>(<span class="i">GrantTypes</span>.<span class="i">Password</span>);
            }
            <b>if</b> (<span class="r6 r">settings</span>.<a href="../Settings/OpenIdServerSettings.cs.html#5b9c7cca277727aa" class="i property">AllowRefreshTokenFlow</a>)
            {
                <span class="r5 r">options</span>.<span class="i">GrantTypes</span>.<span class="i">Add</span>(<span class="i">GrantTypes</span>.<span class="i">RefreshToken</span>);
 
                <span class="r5 r">options</span>.<span class="i">Scopes</span>.<span class="i">Add</span>(<span class="i">Scopes</span>.<span class="i">OfflineAccess</span>);
            }
 
            <span class="r5 r">options</span>.<span class="i">Scopes</span>.<span class="i">Add</span>(<span class="i">Scopes</span>.<span class="i">Email</span>);
            <span class="r5 r">options</span>.<span class="i">Scopes</span>.<span class="i">Add</span>(<span class="i">Scopes</span>.<span class="i">Phone</span>);
            <span class="r5 r">options</span>.<span class="i">Scopes</span>.<span class="i">Add</span>(<span class="i">Scopes</span>.<span class="i">Profile</span>);
            <span class="r5 r">options</span>.<span class="i">Scopes</span>.<span class="i">Add</span>(<span class="i">Scopes</span>.<span class="i">Roles</span>);
        }
 
        <b>public void</b> <a id="902a26a854009dc3" href="../R/902a26a854009dc3.html" target="n" data-glyph="72,1" class="i method">Configure</a>(<span class="i">OpenIddictServerDataProtectionOptions</span> <span id="r9 rd" class="r9 r">options</span>)
        {
            <a href="../Settings/OpenIdServerSettings.cs.html#608b0079a4b49cf3" class="k">var</a> <span id="r10 rd" class="r10 r">settings</span> = <a href="#63683cfa6cf72748" class="i method">GetServerSettingsAsync</a>().<a href="@1@System.Runtime/A.html#e1d639f68b66715a" class="i method">GetAwaiter</a>().<a href="@1@System.Runtime/A.html#c2597ba59f71d619" class="i method">GetResult</a>();
            <b>if</b> (<span class="r10 r">settings</span> == <b>null</b>)
            {
                <b>return</b>;
            }
 
            <span class="c">// All the tokens produced by the server feature use ASP.NET Core Data Protection as the default</span>
            <span class="c">// token format, but an option is provided to allow switching to JWT for access tokens only.</span>
            <span class="r9 r">options</span>.<span class="i">PreferDefaultAccessTokenFormat</span> = <span class="r10 r">settings</span>.<a href="../Settings/OpenIdServerSettings.cs.html#52cdf0f89457c535" class="i property">AccessTokenFormat</a> == <a href="../Settings/OpenIdServerSettings.cs.html#608b0079a4b49cf3" class="t t">OpenIdServerSettings</a>.<a href="../Settings/OpenIdServerSettings.cs.html#b826317a59ac918c" class="t t">TokenFormat</a>.<a href="../Settings/OpenIdServerSettings.cs.html#432a7493458c7bc7" class="i field">JsonWebToken</a>;
        }
 
        <b>public void</b> <a id="ee37b4f99b308422" href="../R/ee37b4f99b308422.html" target="n" data-glyph="72,1" class="i method">Configure</a>(<a href="@1@System.Runtime/A.html#8281103e6f23cb5c" class="k">string</a> <span id="r11 rd" class="r11 r">name</span>, <span class="i">OpenIddictServerAspNetCoreOptions</span> <span id="r12 rd" class="r12 r">options</span>)
        {
            <span class="c">// Note: the OpenID module handles the authorization, logout, token and userinfo requests</span>
            <span class="c">// in its dedicated ASP.NET Core MVC controller, which requires enabling the pass-through mode.</span>
            <span class="r12 r">options</span>.<span class="i">EnableAuthorizationEndpointPassthrough</span> = <b>true</b>;
            <span class="r12 r">options</span>.<span class="i">EnableLogoutEndpointPassthrough</span> = <b>true</b>;
            <span class="r12 r">options</span>.<span class="i">EnableTokenEndpointPassthrough</span> = <b>true</b>;
            <span class="r12 r">options</span>.<span class="i">EnableUserinfoEndpointPassthrough</span> = <b>true</b>;
 
            <span class="c">// Note: caching is enabled for both authorization and logout requests to allow sending</span>
            <span class="c">// large POST authorization and logout requests, but can be programmatically disabled, as the</span>
            <span class="c">// authorization and logout views support flowing the entire payload and not just the request_id.</span>
            <span class="r12 r">options</span>.<span class="i">EnableAuthorizationRequestCaching</span> = <b>true</b>;
            <span class="r12 r">options</span>.<span class="i">EnableLogoutRequestCaching</span> = <b>true</b>;
 
            <span class="c">// Note: error pass-through is enabled to allow the actions of the MVC authorization controller</span>
            <span class="c">// to handle the errors returned by the interactive endpoints without relying on the generic</span>
            <span class="c">// status code pages middleware to rewrite the response later in the request processing.</span>
            <span class="r12 r">options</span>.<span class="i">EnableErrorPassthrough</span> = <b>true</b>;
 
            <span class="c">// Note: in Orchard, transport security is usually configured via the dedicated HTTPS module.</span>
            <span class="c">// To make configuration easier and avoid having to configure it in two different features,</span>
            <span class="c">// the transport security requirement enforced by OpenIddict by default is always turned off.</span>
            <span class="r12 r">options</span>.<span class="i">DisableTransportSecurityRequirement</span> = <b>true</b>;
        }
 
        <b>public void</b> <a id="b9d92902beb019f5" href="../R/b9d92902beb019f5.html" target="n" data-glyph="72,1" class="i method">Configure</a>(<span class="i">OpenIddictServerAspNetCoreOptions</span> <span id="r13 rd" class="r13 r">options</span>)
            =&gt; <a href="@1@System.Runtime/A.html#632c6da37ce825df" class="t t">Debug</a>.<a href="@1@System.Runtime/A.html#edba047e49087cd7" class="i method">Fail</a>(<span class="s">&quot;This infrastructure method shouldn&#39;t be called.&quot;</span>);
 
        <b>private async</b> <a href="@1@System.Runtime/A.html#5ca7b77f3df89fc6" class="t t">Task</a>&lt;<a href="../Settings/OpenIdServerSettings.cs.html#608b0079a4b49cf3" class="t t">OpenIdServerSettings</a>&gt; <a id="63683cfa6cf72748" href="../R/63683cfa6cf72748.html" target="n" data-glyph="76,1" class="i method">GetServerSettingsAsync</a>()
        {
            <a href="../Settings/OpenIdServerSettings.cs.html#608b0079a4b49cf3" class="k">var</a> <span id="r14 rd" class="r14 r">settings</span> = <b>await</b> <a href="#2bf2cb94124ad6f7" class="i field">_serverService</a>.<a href="../Services/IOpenIdServerService.cs.html#946640ea6cbfa2d1" class="i method">GetSettingsAsync</a>();
            <b>if</b> ((<b>await</b> <a href="#2bf2cb94124ad6f7" class="i field">_serverService</a>.<a href="../Services/IOpenIdServerService.cs.html#968709e28d0b010d" class="i method">ValidateSettingsAsync</a>(<span class="r14 r">settings</span>)).<a href="@1@System.Collections.Immutable/A.html#bf86338597b2e4ec" class="i method">Any</a>(<span id="r15 rd" class="r15 r">result</span> =&gt; <span class="r15 r">result</span> != <span class="t t">ValidationResult</span>.<span class="i field">Success</span>))
            {
                <b>if</b> (<a href="#c39a41795385adf0" class="i field">_shellSettings</a>.<span class="i">State</span> == <span class="i">TenantState</span>.<span class="i">Running</span>)
                {
                    <a href="#a5859c3c5e3f54fc" class="i field">_logger</a>.<span class="i method">LogWarning</span>(<span class="s">&quot;The OpenID Connect module is not correctly configured.&quot;</span>);
                }
 
                <b>return</b> <b>null</b>;
            }
 
            <b>return</b> <span class="r14 r">settings</span>;
        }
    }
}
</pre></td></tr></table></div></body></html>
