<!DOCTYPE html>
<html><head><title>ShellContext</title><link rel="stylesheet" href="../../styles.css"/><script src="../../scripts.js"></script></head><body onload="ro();">
<div class="rH">1 type derived from ShellContext</div><div class="rA">OrchardCore.Abstractions (1)</div><div class="rG" id="OrchardCore.Abstractions"><div class="rF"><div class="rN">Shell\Builders\ShellContext.cs (1)</div>
<a href="../Shell/Builders/ShellContext.cs.html#37"><b>37</b>public class PlaceHolder : <i>ShellContext</i></a>
</div>
</div>
<div class="rH">2 instantiations of ShellContext</div><div class="rA">OrchardCore (2)</div><div class="rG" id="OrchardCore"><div class="rF"><div class="rN">Shell\Builders\ShellContextFactory.cs (1)</div>
<a href="../../OrchardCore/Shell/Builders/ShellContextFactory.cs.html#78"><b>78</b>return new <i>ShellContext</i></a>
</div>
<div class="rF"><div class="rN">Shell\ShellHost.cs (1)</div>
<a href="../../OrchardCore/Shell/ShellHost.cs.html#349"><b>349</b>return Task.FromResult(new <i>ShellContext</i> { Settings = settings });</a>
</div>
</div>
<div class="rH">70 references to ShellContext</div><div class="rA">OrchardCore (47)</div><div class="rG" id="OrchardCore"><div class="rF"><div class="rN">Modules\ModularBackgroundService.cs (11)</div>
<a href="../../OrchardCore/Modules/ModularBackgroundService.cs.html#69"><b>69</b>var previousShells = Enumerable.Empty&lt;<i>ShellContext</i>&gt;();</a>
<a href="../../OrchardCore/Modules/ModularBackgroundService.cs.html#91"><b>91</b>private async Task RunAsync(IEnumerable&lt;<i>ShellContext</i>&gt; runningShells, CancellationToken stoppingToken)</a>
<a href="../../OrchardCore/Modules/ModularBackgroundService.cs.html#179"><b>179</b>private async Task UpdateAsync(IEnumerable&lt;<i>ShellContext</i>&gt; previousShells, IEnumerable&lt;<i>ShellContext</i>&gt; runningShells, CancellationToken stoppingToken)</a>
<a href="../../OrchardCore/Modules/ModularBackgroundService.cs.html#287"><b>287</b>private IEnumerable&lt;<i>ShellContext</i>&gt; GetRunningShells()</a>
<a href="../../OrchardCore/Modules/ModularBackgroundService.cs.html#292"><b>292</b>private IEnumerable&lt;<i>ShellContext</i>&gt; GetShellsToRun(IEnumerable&lt;<i>ShellContext</i>&gt; shells)</a>
<a href="../../OrchardCore/Modules/ModularBackgroundService.cs.html#298"><b>298</b>private IEnumerable&lt;<i>ShellContext</i>&gt; GetShellsToUpdate(IEnumerable&lt;<i>ShellContext</i>&gt; previousShells, IEnumerable&lt;<i>ShellContext</i>&gt; runningShells)</a>
<a href="../../OrchardCore/Modules/ModularBackgroundService.cs.html#374"><b>374</b>public static HttpContext CreateHttpContext(this <i>ShellContext</i> shell)</a>
</div>
<div class="rF"><div class="rN">Modules\ModularTenantRouterMiddleware.cs (2)</div>
<a href="../../OrchardCore/Modules/ModularTenantRouterMiddleware.cs.html#44"><b>44</b><i>var</i> shellContext = ShellScope.Context;</a>
<a href="../../OrchardCore/Modules/ModularTenantRouterMiddleware.cs.html#66"><b>66</b>private async Task InitializePipelineAsync(<i>ShellContext</i> shellContext)</a>
</div>
<div class="rF"><div class="rN">Shell\Builders\ShellContextFactory.cs (4)</div>
<a href="../../OrchardCore/Shell/Builders/ShellContextFactory.cs.html#29"><b>29</b>async Task&lt;<i>ShellContext</i>&gt; IShellContextFactory.CreateShellContextAsync(ShellSettings settings)</a>
<a href="../../OrchardCore/Shell/Builders/ShellContextFactory.cs.html#36"><b>36</b><i>var</i> describedContext = await CreateDescribedContextAsync(settings, MinimumShellDescriptor());</a>
<a href="../../OrchardCore/Shell/Builders/ShellContextFactory.cs.html#55"><b>55</b>Task&lt;<i>ShellContext</i>&gt; IShellContextFactory.CreateSetupContextAsync(ShellSettings settings)</a>
<a href="../../OrchardCore/Shell/Builders/ShellContextFactory.cs.html#66"><b>66</b>public async Task&lt;<i>ShellContext</i>&gt; CreateDescribedContextAsync(ShellSettings settings, ShellDescriptor shellDescriptor)</a>
</div>
<div class="rF"><div class="rN">Shell\Distributed\DistributedContext.cs (2)</div>
<a href="../../OrchardCore/Shell/Distributed/DistributedContext.cs.html#11"><b>11</b>private <i>ShellContext</i> _context;</a>
<a href="../../OrchardCore/Shell/Distributed/DistributedContext.cs.html#15"><b>15</b>public DistributedContext(<i>ShellContext</i> context)</a>
</div>
<div class="rF"><div class="rN">Shell\Distributed\DistributedShellHostedService.cs (7)</div>
<a href="../../OrchardCore/Shell/Distributed/DistributedShellHostedService.cs.html#40"><b>40</b>private <i>ShellContext</i> _defaultContext;</a>
<a href="../../OrchardCore/Shell/Distributed/DistributedShellHostedService.cs.html#86"><b>86</b>if (!_shellHost.TryGetShellContext(ShellHelper.DefaultShellName, out <i>var</i> defaultContext) ||</a>
<a href="../../OrchardCore/Shell/Distributed/DistributedShellHostedService.cs.html#311"><b>311</b>if (!_shellHost.TryGetShellContext(ShellHelper.DefaultShellName, out <i>var</i> defaultContext) ||</a>
<a href="../../OrchardCore/Shell/Distributed/DistributedShellHostedService.cs.html#362"><b>362</b>if (!_shellHost.TryGetShellContext(ShellHelper.DefaultShellName, out <i>var</i> defaultContext) ||</a>
<a href="../../OrchardCore/Shell/Distributed/DistributedShellHostedService.cs.html#415"><b>415</b>private async Task&lt;DistributedContext&gt; CreateDistributedContextAsync(<i>ShellContext</i> defaultShell)</a>
<a href="../../OrchardCore/Shell/Distributed/DistributedShellHostedService.cs.html#454"><b>454</b>private async Task&lt;DistributedContext&gt; GetOrCreateDistributedContextAsync(<i>ShellContext</i> defaultContext)</a>
<a href="../../OrchardCore/Shell/Distributed/DistributedShellHostedService.cs.html#479"><b>479</b>private Task&lt;DistributedContext&gt; AcquireOrCreateDistributedContextAsync(<i>ShellContext</i> defaultContext)</a>
</div>
<div class="rF"><div class="rN">Shell\ShellHost.cs (21)</div>
<a href="../../OrchardCore/Shell/ShellHost.cs.html#18"><b>18</b>/// All &lt;see cref=&quot;<i>ShellContext</i>&quot;/&gt; are pre-created when &lt;see cref=&quot;InitializeAsync&quot;/&gt; is called on startup and where we first load</a>
<a href="../../OrchardCore/Shell/ShellHost.cs.html#20"><b>20</b>/// For each &lt;see cref=&quot;<i>ShellContext</i>&quot;/&gt; a service container and then a request pipeline are only built on the first matching request.</a>
<a href="../../OrchardCore/Shell/ShellHost.cs.html#33"><b>33</b>private readonly ConcurrentDictionary&lt;string, <i>ShellContext</i>&gt; _shellContexts = new ConcurrentDictionary&lt;string, <i>ShellContext</i>&gt;();</a>
<a href="../../OrchardCore/Shell/ShellHost.cs.html#77"><b>77</b>public async Task&lt;<i>ShellContext</i>&gt; GetOrCreateShellContextAsync(ShellSettings settings)</a>
<a href="../../OrchardCore/Shell/ShellHost.cs.html#79"><b>79</b><i>ShellContext</i> shell = null;</a>
<a href="../../OrchardCore/Shell/ShellHost.cs.html#121"><b>121</b>if (!_shellContexts.TryGetValue(settings.Name, out <i>var</i> shellContext))</a>
<a href="../../OrchardCore/Shell/ShellHost.cs.html#190"><b>190</b>if (_shellContexts.TryRemove(settings.Name, out <i>var</i> context))</a>
<a href="../../OrchardCore/Shell/ShellHost.cs.html#197"><b>197</b>if (!_shellContexts.TryAdd(settings.Name, new <i>ShellContext</i>.PlaceHolder { Settings = settings }))</a>
<a href="../../OrchardCore/Shell/ShellHost.cs.html#254"><b>254</b>if (_shellContexts.TryRemove(settings.Name, out <i>var</i> context))</a>
<a href="../../OrchardCore/Shell/ShellHost.cs.html#260"><b>260</b>if (_shellContexts.TryAdd(settings.Name, new <i>ShellContext</i>.PlaceHolder { Settings = settings }))</a>
<a href="../../OrchardCore/Shell/ShellHost.cs.html#268"><b>268</b>public IEnumerable&lt;<i>ShellContext</i>&gt; ListShellContexts() =&gt; _shellContexts.Values.ToArray();</a>
<a href="../../OrchardCore/Shell/ShellHost.cs.html#274"><b>274</b>public bool TryGetShellContext(string name, out <i>ShellContext</i> shellContext) =&gt; _shellContexts.TryGetValue(name, out shellContext);</a>
<a href="../../OrchardCore/Shell/ShellHost.cs.html#312"><b>312</b><i>var</i> setupContext = await CreateSetupContextAsync(defaultSettings);</a>
<a href="../../OrchardCore/Shell/ShellHost.cs.html#319"><b>319</b>AddAndRegisterShell(new <i>ShellContext</i>.PlaceHolder { Settings = settings });</a>
<a href="../../OrchardCore/Shell/ShellHost.cs.html#331"><b>331</b>private Task&lt;<i>ShellContext</i>&gt; CreateShellContextAsync(ShellSettings settings)</a>
<a href="../../OrchardCore/Shell/ShellHost.cs.html#369"><b>369</b>private Task&lt;<i>ShellContext</i>&gt; CreateSetupContextAsync(ShellSettings defaultSettings)</a>
<a href="../../OrchardCore/Shell/ShellHost.cs.html#391"><b>391</b>private void AddAndRegisterShell(<i>ShellContext</i> context)</a>
<a href="../../OrchardCore/Shell/ShellHost.cs.html#407"><b>407</b>private bool CanRegisterShell(<i>ShellContext</i> context)</a>
<a href="../../OrchardCore/Shell/ShellHost.cs.html#465"><b>465</b>return settings.State != TenantState.Disabled || _shellContexts.TryGetValue(settings.Name, out <i>var</i> value) &amp;&amp; value.ActiveScopes == 0;</a>
<a href="../../OrchardCore/Shell/ShellHost.cs.html#470"><b>470</b>foreach (<i>var</i> shell in ListShellContexts())</a>
</div>
</div>
<div class="rA">OrchardCore.Abstractions (22)</div><div class="rG" id="OrchardCore.Abstractions"><div class="rF"><div class="rN">Shell\Builders\IShellContextFactory.cs (3)</div>
<a href="../Shell/Builders/IShellContextFactory.cs.html#15"><b>15</b>Task&lt;<i>ShellContext</i>&gt; CreateShellContextAsync(ShellSettings settings);</a>
<a href="../Shell/Builders/IShellContextFactory.cs.html#21"><b>21</b>Task&lt;<i>ShellContext</i>&gt; CreateSetupContextAsync(ShellSettings settings);</a>
<a href="../Shell/Builders/IShellContextFactory.cs.html#27"><b>27</b>Task&lt;<i>ShellContext</i>&gt; CreateDescribedContextAsync(ShellSettings settings, ShellDescriptor shellDescriptor);</a>
</div>
<div class="rF"><div class="rN">Shell\Builders\ShellContext.cs (8)</div>
<a href="../Shell/Builders/ShellContext.cs.html#16"><b>16</b>private List&lt;WeakReference&lt;<i>ShellContext</i>&gt;&gt; _dependents;</a>
<a href="../Shell/Builders/ShellContext.cs.html#74"><b>74</b>/// Whether the &lt;see cref=&quot;<i>ShellContext</i>&quot;/&gt; instance is not yet built or has been released, for instance when a tenant is changed.</a>
<a href="../Shell/Builders/ShellContext.cs.html#84"><b>84</b>/// Mark the &lt;see cref=&quot;<i>ShellContext</i>&quot;/&gt; as released and then a candidate to be disposed.</a>
<a href="../Shell/Builders/ShellContext.cs.html#123"><b>123</b>if (dependent.TryGetTarget(out <i>var</i> shellContext))</a>
<a href="../Shell/Builders/ShellContext.cs.html#165"><b>165</b>public void AddDependentShell(<i>ShellContext</i> shellContext)</a>
<a href="../Shell/Builders/ShellContext.cs.html#185"><b>185</b>_dependents = new List&lt;WeakReference&lt;<i>ShellContext</i>&gt;&gt;();</a>
<a href="../Shell/Builders/ShellContext.cs.html#189"><b>189</b>_dependents.RemoveAll(x =&gt; !x.TryGetTarget(out <i>var</i> shell) || shell.Settings.Name == shellContext.Settings.Name);</a>
<a href="../Shell/Builders/ShellContext.cs.html#191"><b>191</b>_dependents.Add(new WeakReference&lt;<i>ShellContext</i>&gt;(shellContext));</a>
</div>
<div class="rF"><div class="rN">Shell\Builders\ShellContextExtensions.cs (1)</div>
<a href="../Shell/Builders/ShellContextExtensions.cs.html#16"><b>16</b>public static Task&lt;(ILocker locker, bool locked)&gt; TryAcquireShellActivateLockAsync(this <i>ShellContext</i> shellContext)</a>
</div>
<div class="rF"><div class="rN">Shell\IShellHost.cs (6)</div>
<a href="../Shell/IShellHost.cs.html#12"><b>12</b>/// Ensure that all the &lt;see cref=&quot;<i>ShellContext</i>&quot;/&gt; are pre-created and available to process requests.</a>
<a href="../Shell/IShellHost.cs.html#17"><b>17</b>/// Returns an existing &lt;see cref=&quot;<i>ShellContext</i>&quot;/&gt; or creates a new one if necessary.</a>
<a href="../Shell/IShellHost.cs.html#19"><b>19</b>Task&lt;<i>ShellContext</i>&gt; GetOrCreateShellContextAsync(ShellSettings settings);</a>
<a href="../Shell/IShellHost.cs.html#52"><b>52</b>/// Lists all available &lt;see cref=&quot;<i>ShellContext</i>&quot;/&gt; instances.</a>
<a href="../Shell/IShellHost.cs.html#56"><b>56</b>IEnumerable&lt;<i>ShellContext</i>&gt; ListShellContexts();</a>
<a href="../Shell/IShellHost.cs.html#62"><b>62</b>bool TryGetShellContext(string name, out <i>ShellContext</i> shellContext);</a>
</div>
<div class="rF"><div class="rN">Shell\Scope\ShellScope.cs (3)</div>
<a href="../Shell/Scope/ShellScope.cs.html#34"><b>34</b>public ShellScope(<i>ShellContext</i> shellContext)</a>
<a href="../Shell/Scope/ShellScope.cs.html#55"><b>55</b>public <i>ShellContext</i> ShellContext { get; }</a>
<a href="../Shell/Scope/ShellScope.cs.html#61"><b>61</b>public static <i>ShellContext</i> Context =&gt; Current?.ShellContext;</a>
</div>
<div class="rF"><div class="rN">Shell\ShellContextFeature.cs (1)</div>
<a href="../Shell/ShellContextFeature.cs.html#14"><b>14</b>public <i>ShellContext</i> ShellContext { get; set; }</a>
</div>
</div>
<div class="rA">OrchardCore.Setup.Core (1)</div><div class="rG" id="OrchardCore.Setup.Core"><div class="rF"><div class="rN">SetupService.cs (1)</div>
<a href="../../OrchardCore.Setup.Core/SetupService.cs.html#175"><b>175</b>using (<i>var</i> shellContext = await _shellContextFactory.CreateDescribedContextAsync(shellSettings, shellDescriptor))</a>
</div>
</div>
</body></html>