<!DOCTYPE html>
<html><head><title>DateTimeShapes.cs</title><link rel="stylesheet" href="../../styles.css"><script src="../../scripts.js"></script></head>
<body class="cB" onload="i(116);"><div class="dH">
<table style="width: 100%">
<tr><td>File: <a id="filePath" class="blueLink" href="/#OrchardCore.DisplayManagement/Shapes/DateTimeShapes.cs" target="_top">Shapes\DateTimeShapes.cs</a><br/></td><td></td></tr>
<tr><td>Project: <a id="projectPath" class="blueLink" href="/#OrchardCore.DisplayManagement" target="_top">src\OrchardCore\OrchardCore.DisplayManagement\OrchardCore.DisplayManagement.csproj</a> (OrchardCore.DisplayManagement)</td><td></td></tr>
</table>
</div>
<div class="cz"><table class="tb" cellpadding="0" cellspacing="0"><tr><td valign="top" align="right"><pre id="ln"></pre></td><td valign="top" align="left"><pre id="code">
<b>using</b> <span class="i n">System</span>;
<b>using</b> <span class="i n">System</span>.<span class="i n">Globalization</span>;
<b>using</b> <span class="i n">System</span>.<span class="i n">Threading</span>.<span class="i n">Tasks</span>;
<b>using</b> <span class="i n">Microsoft</span>.<span class="i n">AspNetCore</span>.<span class="i n">Html</span>;
<b>using</b> <span class="i n">Microsoft</span>.<span class="i n">AspNetCore</span>.<span class="i n">Mvc</span>.<span class="i n">Localization</span>;
<b>using</b> <span class="i n">Microsoft</span>.<span class="i n">AspNetCore</span>.<span class="i n">Mvc</span>.<span class="i n">Rendering</span>;
<b>using</b> <span class="i n">Microsoft</span>.<span class="i n">Extensions</span>.<span class="i n">Localization</span>;
<b>using</b> <span class="i n">OrchardCore</span>.<span class="i n">DisplayManagement</span>.<span class="i n">Descriptors</span>;
<b>using</b> <span class="i n">OrchardCore</span>.<span class="i">Modules</span>;
 
<b>namespace</b> <span class="i n">OrchardCore</span>.<span class="i n">DisplayManagement</span>.<span class="i n">Shapes</span>
{
    [<span class="i">Feature</span>(<span class="i">Application</span>.<span class="i">DefaultFeatureId</span>)]
    <b>public class</b> <a id="2dd80bafd5dd96d4" href="../R/2dd80bafd5dd96d4.html" target="n" data-glyph="0,0" class="t t">DateTimeShapes</a> : <a href="../Descriptors/Interfaces.cs.html#4ed6c423bfefa6c8" class="t t">IShapeAttributeProvider</a>
    {
        <b>private const string</b> <a id="782f07a7201cd9c3" href="../R/782f07a7201cd9c3.html" target="n" data-glyph="10,1" class="i field">LongDateTimeFormat</a> = <span class="s">&quot;dddd, MMMM d, yyyy h:mm:ss tt&quot;</span>;
        <b>private readonly</b> <span class="i">IClock</span> <a id="5565ce5b332557ad" href="../R/5565ce5b332557ad.html" target="n" data-glyph="46,1" class="i field">_clock</a>;
        <b>private readonly</b> <span class="i">ILocalClock</span> <a id="021e89b94db7ae9c" href="../R/021e89b94db7ae9c.html" target="n" data-glyph="46,1" class="i field">_localClock</a>;
        <b>private readonly</b> <span class="t t">IStringLocalizer</span> <a id="af28e1e52e423666" href="../R/af28e1e52e423666.html" target="n" data-glyph="46,1" class="i field">S</a>;
        <b>private readonly</b> <span class="t t">IHtmlLocalizer</span> <a id="68954662b5e608f8" href="../R/68954662b5e608f8.html" target="n" data-glyph="46,1" class="i field">H</a>;
 
        <b>public</b> <a id="de6c6b8db0b8fc6c" href="../R/../../0000000000.html" target="n" data-glyph="72,1" class="t constructor">DateTimeShapes</a>(
            <span class="i">IClock</span> <span id="r0 rd" class="r0 r">clock</span>,
            <span class="t t">IStringLocalizer</span>&lt;<a href="#2dd80bafd5dd96d4" class="t t">DateTimeShapes</a>&gt; <span id="r1 rd" class="r1 r">localizer</span>,
            <span class="t t">IHtmlLocalizer</span>&lt;<a href="#2dd80bafd5dd96d4" class="t t">DateTimeShapes</a>&gt; <span id="r2 rd" class="r2 r">htmlLocalizer</span>,
            <span class="i">ILocalClock</span> <span id="r3 rd" class="r3 r">localClock</span>
            )
        {
            <a href="#021e89b94db7ae9c" class="i field">_localClock</a> = <span class="r3 r">localClock</span>;
            <a href="#5565ce5b332557ad" class="i field">_clock</a> = <span class="r0 r">clock</span>;
            <a href="#af28e1e52e423666" class="i field">S</a> = <span class="r1 r">localizer</span>;
            <a href="#68954662b5e608f8" class="i field">H</a> = <span class="r2 r">htmlLocalizer</span>;
        }
 
        [<a href="../ShapeAttribute.cs.html#d2dc94628af9e80a" class="t constructor">Shape</a>]
        <b>public</b> <span class="t t">IHtmlContent</span> <a id="fd18d4f4f472ebfb" href="../R/../../0000000000.html" target="n" data-glyph="72,1" class="i method">TimeSpan</a>(<span class="t t">IHtmlHelper</span> <span id="r4 rd" class="r4 r">Html</span>, <a href="@1@System.Runtime/A.html#df6b1eba7461813b" class="t t">DateTime</a>? <span id="r5 rd" class="r5 r">Utc</span>, <a href="@1@System.Runtime/A.html#df6b1eba7461813b" class="t t">DateTime</a>? <span id="r6 rd" class="r6 r">Origin</span>)
        {
            <span class="r5 r">Utc</span> = <span class="r5 r">Utc</span> ?? <a href="#5565ce5b332557ad" class="i field">_clock</a>.<span class="i">UtcNow</span>;
            <span class="r6 r">Origin</span> = <span class="r6 r">Origin</span> ?? <a href="#5565ce5b332557ad" class="i field">_clock</a>.<span class="i">UtcNow</span>;
 
            <b>var</b> <span id="r7 rd" class="r7 r">time</span> = <a href="#5565ce5b332557ad" class="i field">_clock</a>.<span class="i">UtcNow</span> - <span class="r5 r">Utc</span>.<a href="@1@System.Runtime/A.html#7b38d1fa76071c95" class="i property">Value</a>;
 
            <b>if</b> (<span class="r7 r">time</span>.<span class="i">TotalYears</span>() &gt; 1)
                <b>return</b> <a href="#68954662b5e608f8" class="i field">H</a>.<a href="/OrchardCore.Localization.Abstractions/A.html#cfeacff9b47f0cbc" class="i method">Plural</a>(<span class="r7 r">time</span>.<span class="i">TotalYears</span>(), <span class="s">&quot;1 year ago&quot;</span>, <span class="s">&quot;{0} years ago&quot;</span>);
            <b>if</b> (<span class="r7 r">time</span>.<span class="i">TotalYears</span>() &lt; -1)
                <b>return</b> <a href="#68954662b5e608f8" class="i field">H</a>.<a href="/OrchardCore.Localization.Abstractions/A.html#cfeacff9b47f0cbc" class="i method">Plural</a>(-<span class="r7 r">time</span>.<span class="i">TotalYears</span>(), <span class="s">&quot;in 1 year&quot;</span>, <span class="s">&quot;in {0} years&quot;</span>);
 
            <b>if</b> (<span class="r7 r">time</span>.<span class="i">TotalMonths</span>() &gt; 1)
                <b>return</b> <a href="#68954662b5e608f8" class="i field">H</a>.<a href="/OrchardCore.Localization.Abstractions/A.html#cfeacff9b47f0cbc" class="i method">Plural</a>(<span class="r7 r">time</span>.<span class="i">TotalMonths</span>(), <span class="s">&quot;1 month ago&quot;</span>, <span class="s">&quot;{0} months ago&quot;</span>);
            <b>if</b> (<span class="r7 r">time</span>.<span class="i">TotalMonths</span>() &lt; -1)
                <b>return</b> <a href="#68954662b5e608f8" class="i field">H</a>.<a href="/OrchardCore.Localization.Abstractions/A.html#cfeacff9b47f0cbc" class="i method">Plural</a>(-<span class="r7 r">time</span>.<span class="i">TotalMonths</span>(), <span class="s">&quot;in 1 month&quot;</span>, <span class="s">&quot;in {0} months&quot;</span>);
 
            <b>if</b> (<span class="r7 r">time</span>.<span class="i">TotalWeeks</span>() &gt; 1)
                <b>return</b> <a href="#68954662b5e608f8" class="i field">H</a>.<a href="/OrchardCore.Localization.Abstractions/A.html#cfeacff9b47f0cbc" class="i method">Plural</a>(<span class="r7 r">time</span>.<span class="i">TotalWeeks</span>(), <span class="s">&quot;1 week ago&quot;</span>, <span class="s">&quot;{0} weeks ago&quot;</span>);
            <b>if</b> (<span class="r7 r">time</span>.<span class="i">TotalWeeks</span>() &lt; -1)
                <b>return</b> <a href="#68954662b5e608f8" class="i field">H</a>.<a href="/OrchardCore.Localization.Abstractions/A.html#cfeacff9b47f0cbc" class="i method">Plural</a>(-<span class="r7 r">time</span>.<span class="i">TotalWeeks</span>(), <span class="s">&quot;in 1 week&quot;</span>, <span class="s">&quot;in {0} weeks&quot;</span>);
 
            <b>if</b> (<span class="r7 r">time</span>.<span class="i">TotalHours</span> &gt; 24)
                <b>return</b> <a href="#68954662b5e608f8" class="i field">H</a>.<span class="i">Plural</span>(<span class="r7 r">time</span>.<span class="i">Days</span>, <span class="s">&quot;1 day ago&quot;</span>, <span class="s">&quot;{0} days ago&quot;</span>);
            <b>if</b> (<span class="r7 r">time</span>.<span class="i">TotalHours</span> &lt; -24)
                <b>return</b> <a href="#68954662b5e608f8" class="i field">H</a>.<span class="i">Plural</span>(-<span class="r7 r">time</span>.<span class="i">Days</span>, <span class="s">&quot;in 1 day&quot;</span>, <span class="s">&quot;in {0} days&quot;</span>);
 
            <b>if</b> (<span class="r7 r">time</span>.<span class="i">TotalMinutes</span> &gt; 60)
                <b>return</b> <a href="#68954662b5e608f8" class="i field">H</a>.<span class="i">Plural</span>(<span class="r7 r">time</span>.<span class="i">Hours</span>, <span class="s">&quot;1 hour ago&quot;</span>, <span class="s">&quot;{0} hours ago&quot;</span>);
            <b>if</b> (<span class="r7 r">time</span>.<span class="i">TotalMinutes</span> &lt; -60)
                <b>return</b> <a href="#68954662b5e608f8" class="i field">H</a>.<span class="i">Plural</span>(-<span class="r7 r">time</span>.<span class="i">Hours</span>, <span class="s">&quot;in 1 hour&quot;</span>, <span class="s">&quot;in {0} hours&quot;</span>);
 
            <b>if</b> (<span class="r7 r">time</span>.<span class="i">TotalSeconds</span> &gt; 60)
                <b>return</b> <a href="#68954662b5e608f8" class="i field">H</a>.<span class="i">Plural</span>(<span class="r7 r">time</span>.<span class="i">Minutes</span>, <span class="s">&quot;1 minute ago&quot;</span>, <span class="s">&quot;{0} minutes ago&quot;</span>);
            <b>if</b> (<span class="r7 r">time</span>.<span class="i">TotalSeconds</span> &lt; -60)
                <b>return</b> <a href="#68954662b5e608f8" class="i field">H</a>.<span class="i">Plural</span>(-<span class="r7 r">time</span>.<span class="i">Minutes</span>, <span class="s">&quot;in 1 minute&quot;</span>, <span class="s">&quot;in {0} minutes&quot;</span>);
 
            <b>if</b> (<span class="r7 r">time</span>.<span class="i">TotalSeconds</span> &gt; 10)
                <b>return</b> <a href="#68954662b5e608f8" class="i field">H</a>.<span class="i">Plural</span>(<span class="r7 r">time</span>.<span class="i">Seconds</span>, <span class="s">&quot;1 second ago&quot;</span>, <span class="s">&quot;{0} seconds ago&quot;</span>); <span class="c">//aware that the singular won&#39;t be used</span>
            <b>if</b> (<span class="r7 r">time</span>.<span class="i">TotalSeconds</span> &lt; -10)
                <b>return</b> <a href="#68954662b5e608f8" class="i field">H</a>.<span class="i">Plural</span>(-<span class="r7 r">time</span>.<span class="i">Seconds</span>, <span class="s">&quot;in 1 second&quot;</span>, <span class="s">&quot;in {0} seconds&quot;</span>);
 
            <b>return</b> <span class="r7 r">time</span>.<span class="i">TotalMilliseconds</span> &gt; 0
                       ? <a href="#68954662b5e608f8" class="i field">H</a>[<span class="s">&quot;a moment ago&quot;</span>]
                       : <a href="#68954662b5e608f8" class="i field">H</a>[<span class="s">&quot;in a moment&quot;</span>];
        }
 
        [<a href="../ShapeAttribute.cs.html#d2dc94628af9e80a" class="t constructor">Shape</a>]
        <b>public async</b> <a href="@1@System.Runtime/A.html#5ca7b77f3df89fc6" class="t t">Task</a>&lt;<span class="t t">IHtmlContent</span>&gt; <a id="0415bfece04a9128" href="../R/../../0000000000.html" target="n" data-glyph="72,1" class="i method">DateTime</a>(<span class="t t">IHtmlHelper</span> <span id="r8 rd" class="r8 r">Html</span>, <a href="@1@System.Runtime/A.html#df6b1eba7461813b" class="t t">DateTime</a>? <span id="r9 rd" class="r9 r">Utc</span>, <a href="@1@System.Runtime/A.html#8281103e6f23cb5c" class="k">string</a> <span id="r10 rd" class="r10 r">Format</span>)
        {
            <span class="r9 r">Utc</span> = <span class="r9 r">Utc</span> ?? <a href="#5565ce5b332557ad" class="i field">_clock</a>.<span class="i">UtcNow</span>;
            <b>var</b> <span id="r11 rd" class="r11 r">zonedTime</span> = <b>await</b> <a href="#021e89b94db7ae9c" class="i field">_localClock</a>.<span class="i">ConvertToLocalAsync</span>(<span class="r9 r">Utc</span>.<a href="@1@System.Runtime/A.html#7b38d1fa76071c95" class="i property">Value</a>);
 
            <b>if</b> (<span class="r10 r">Format</span> == <b>null</b>)
            {
                <span class="r10 r">Format</span> = <a href="#af28e1e52e423666" class="i field">S</a>[<a href="#782f07a7201cd9c3" class="i field">LongDateTimeFormat</a>].<span class="i property">Value</span>;
            }
 
            <b>return</b> <span class="r8 r">Html</span>.<span class="i method">Raw</span>(<span class="r8 r">Html</span>.<span class="i">Encode</span>(<span class="r11 r">zonedTime</span>.<span class="i">ToString</span>(<span class="r10 r">Format</span>, <a href="@1@System.Runtime/A.html#e319c6636909012f" class="t t">CultureInfo</a>.<a href="@1@System.Runtime/A.html#ff8fd0bdccb4794e" class="i property">CurrentUICulture</a>)));
        }
    }
 
    <b>public static class</b> <a id="5826e11b727b2dc8" href="../R/../../0000000000.html" target="n" data-glyph="0,0" class="t t">TimespanExtensions</a>
    {
        <b>public static int</b> <a id="1d2cf7ae67336a03" href="../R/../../0000000000.html" target="n" data-glyph="220,1" class="i method">TotalWeeks</a>(<b>this</b> <a href="@1@System.Runtime/A.html#865ef7b89f41b632" class="t t">TimeSpan</a> <span id="r12 rd" class="r12 r">time</span>)
        {
            <b>return</b> (<b>int</b>)<span class="r12 r">time</span>.<a href="@1@System.Runtime/A.html#d0bc7009a734d3ee" class="i property">TotalDays</a> / 7;
        }
 
        <b>public static int</b> <a id="be431154eb8df8a6" href="../R/../../0000000000.html" target="n" data-glyph="220,1" class="i method">TotalMonths</a>(<b>this</b> <a href="@1@System.Runtime/A.html#865ef7b89f41b632" class="t t">TimeSpan</a> <span id="r13 rd" class="r13 r">time</span>)
        {
            <b>return</b> (<b>int</b>)<span class="r13 r">time</span>.<a href="@1@System.Runtime/A.html#d0bc7009a734d3ee" class="i property">TotalDays</a> / 31;
        }
 
        <b>public static int</b> <a id="cc3cd8fec5fe8707" href="../R/../../0000000000.html" target="n" data-glyph="220,1" class="i method">TotalYears</a>(<b>this</b> <a href="@1@System.Runtime/A.html#865ef7b89f41b632" class="t t">TimeSpan</a> <span id="r14 rd" class="r14 r">time</span>)
        {
            <b>return</b> (<b>int</b>)<span class="r14 r">time</span>.<a href="@1@System.Runtime/A.html#d0bc7009a734d3ee" class="i property">TotalDays</a> / 365;
        }
    }
}
</pre></td></tr></table></div></body></html>
