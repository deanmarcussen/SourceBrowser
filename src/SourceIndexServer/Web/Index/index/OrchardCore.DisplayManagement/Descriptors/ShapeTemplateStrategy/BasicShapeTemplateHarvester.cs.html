<!DOCTYPE html>
<html><head><title>BasicShapeTemplateHarvester.cs</title><link rel="stylesheet" href="../../../styles.css"><script src="../../../scripts.js"></script></head>
<body class="cB" onload="i(61);"><div class="dH">
<table style="width: 100%">
<tr><td>File: <a id="filePath" class="blueLink" href="/#OrchardCore.DisplayManagement/Descriptors/ShapeTemplateStrategy/BasicShapeTemplateHarvester.cs" target="_top">Descriptors\ShapeTemplateStrategy\BasicShapeTemplateHarvester.cs</a><br/></td><td></td></tr>
<tr><td>Project: <a id="projectPath" class="blueLink" href="/#OrchardCore.DisplayManagement" target="_top">src\OrchardCore\OrchardCore.DisplayManagement\OrchardCore.DisplayManagement.csproj</a> (OrchardCore.DisplayManagement)</td><td></td></tr>
</table>
</div>
<div class="cz"><table class="tb" cellpadding="0" cellspacing="0"><tr><td valign="top" align="right"><pre id="ln"></pre></td><td valign="top" align="left"><pre id="code">
<b>using</b> <span class="i n">System</span>;
<b>using</b> <span class="i n">System</span>.<span class="i n">Collections</span>.<span class="i n">Generic</span>;
 
<b>namespace</b> <span class="i n">OrchardCore</span>.<span class="i n">DisplayManagement</span>.<span class="i n">Descriptors</span>.<span class="i n">ShapeTemplateStrategy</span>
{
    <b>public class</b> <a id="28252a135ba81a57" href="../../R/28252a135ba81a57.html" target="n" data-glyph="0,0" class="t t"><span id="c9586914a6f1961c">BasicShapeTemplateHarvester</span></a> : <a href="IShapeTemplateHarvester.cs.html#2e77008b73d6eabd" class="t t">IShapeTemplateHarvester</a>
    {
        <b>public</b> <a href="@1@System.Runtime/A.html#3acf01620172c7f0" class="t t">IEnumerable</a>&lt;<a href="@1@System.Runtime/A.html#8281103e6f23cb5c" class="k">string</a>&gt; <a id="9a77644d1caa43ed" href="../../R/9a77644d1caa43ed.html" target="n" data-glyph="72,1" class="i method">SubPaths</a>()
        {
            <b>return</b> <b>new</b>[] { <span class="s">&quot;Views&quot;</span>, <span class="s">&quot;Views/Items&quot;</span>, <span class="s">&quot;Views/Parts&quot;</span>, <span class="s">&quot;Views/Fields&quot;</span>, <span class="s">&quot;Views/Elements&quot;</span> };
        }
 
        <b>public</b> <a href="@1@System.Runtime/A.html#3acf01620172c7f0" class="t t">IEnumerable</a>&lt;<a href="HarvestShapeHit.cs.html#90fb57efca7f0c7f" class="t t">HarvestShapeHit</a>&gt; <a id="d19ae8ea13ab26d8" href="../../R/d19ae8ea13ab26d8.html" target="n" data-glyph="72,1" class="i method">HarvestShape</a>(<a href="HarvestShapeInfo.cs.html#141b918f93c3b47a" class="t t">HarvestShapeInfo</a> <span id="r0 rd" class="r0 r">info</span>)
        {
            <a href="@1@System.Runtime/A.html#225942ed7b7a3252" class="k">var</a> <span id="r1 rd" class="r1 r">lastDash</span> = <span class="r0 r">info</span>.<a href="HarvestShapeInfo.cs.html#1f60acc69f78d634" class="i property">FileName</a>.<a href="@1@System.Runtime/A.html#43ea090a2243545e" class="i method">LastIndexOf</a>(<span class="s">&#39;-&#39;</span>);
            <a href="@1@System.Runtime/A.html#225942ed7b7a3252" class="k">var</a> <span id="r2 rd" class="r2 r">lastDot</span> = <span class="r0 r">info</span>.<a href="HarvestShapeInfo.cs.html#1f60acc69f78d634" class="i property">FileName</a>.<a href="@1@System.Runtime/A.html#43ea090a2243545e" class="i method">LastIndexOf</a>(<span class="s">&#39;.&#39;</span>);
            <b>if</b> (<span class="r2 r">lastDot</span> &lt;= 0 || <span class="r2 r">lastDot</span> &lt; <span class="r1 r">lastDash</span>)
            {
                <b>yield</b> <b>return</b> <b>new</b> <a href="HarvestShapeHit.cs.html#90fb57efca7f0c7f" class="t constructor">HarvestShapeHit</a>
                {
                    <a href="HarvestShapeHit.cs.html#bbf873434acb7a29" class="i property">ShapeType</a> = <a href="#9fde329ce100dca7" class="i method">Adjust</a>(<span class="r0 r">info</span>.<a href="HarvestShapeInfo.cs.html#55b396e85225afb9" class="i property">SubPath</a>, <span class="r0 r">info</span>.<a href="HarvestShapeInfo.cs.html#1f60acc69f78d634" class="i property">FileName</a>, <b>null</b>)
                };
            }
            <b>else</b>
            {
                <a href="@1@System.Runtime/A.html#8281103e6f23cb5c" class="k">var</a> <span id="r3 rd" class="r3 r">displayType</span> = <span class="r0 r">info</span>.<a href="HarvestShapeInfo.cs.html#1f60acc69f78d634" class="i property">FileName</a>.<a href="@1@System.Runtime/A.html#882fa7998d6ca35a" class="i method">Substring</a>(<span class="r2 r">lastDot</span> + 1);
                <b>yield</b> <b>return</b> <b>new</b> <a href="HarvestShapeHit.cs.html#90fb57efca7f0c7f" class="t constructor">HarvestShapeHit</a>
                {
                    <a href="HarvestShapeHit.cs.html#bbf873434acb7a29" class="i property">ShapeType</a> = <a href="#9fde329ce100dca7" class="i method">Adjust</a>(<span class="r0 r">info</span>.<a href="HarvestShapeInfo.cs.html#55b396e85225afb9" class="i property">SubPath</a>, <span class="r0 r">info</span>.<a href="HarvestShapeInfo.cs.html#1f60acc69f78d634" class="i property">FileName</a>.<a href="@1@System.Runtime/A.html#8124961f027d9ac9" class="i method">Substring</a>(0, <span class="r2 r">lastDot</span>), <span class="r3 r">displayType</span>),
                    <a href="HarvestShapeHit.cs.html#0d116ba95179837c" class="i property">DisplayType</a> = <span class="r3 r">displayType</span>
                };
            }
        }
 
        <b>private static string</b> <a id="9fde329ce100dca7" href="../../R/9fde329ce100dca7.html" target="n" data-glyph="76,1" class="i method">Adjust</a>(<a href="@1@System.Runtime/A.html#8281103e6f23cb5c" class="k">string</a> <span id="r4 rd" class="r4 r">subPath</span>, <a href="@1@System.Runtime/A.html#8281103e6f23cb5c" class="k">string</a> <span id="r5 rd" class="r5 r">fileName</span>, <a href="@1@System.Runtime/A.html#8281103e6f23cb5c" class="k">string</a> <span id="r6 rd" class="r6 r">displayType</span>)
        {
            <a href="@1@System.Runtime/A.html#8281103e6f23cb5c" class="k">var</a> <span id="r7 rd" class="r7 r">leader</span> = <span class="s">&quot;&quot;</span>;
            <b>if</b> (<span class="r4 r">subPath</span>.<a href="@1@System.Runtime/A.html#1c787ba07a7b11ab" class="i method">StartsWith</a>(<span class="s">&quot;Views/&quot;</span>, <a href="@1@System.Runtime/A.html#702797def97ecb7c" class="t t">StringComparison</a>.<a href="@1@System.Runtime/A.html#87891a6d28c64c9b" class="i field">Ordinal</a>) &amp;&amp; <span class="r4 r">subPath</span> != <span class="s">&quot;Views/Items&quot;</span>)
            {
                <span class="r7 r">leader</span> = <span class="r4 r">subPath</span>.<a href="@1@System.Runtime/A.html#882fa7998d6ca35a" class="i method">Substring</a>(<span class="s">&quot;Views/&quot;</span>.<a href="@1@System.Runtime/A.html#e13f5829ef28aa07" class="i property">Length</a>) + <span class="s">&quot;_&quot;</span>;
            }
 
            <span class="c">// canonical shape type names must not have - or . to be compatible</span>
            <span class="c">// with display and shape api calls)))</span>
            <a href="@1@System.Runtime/A.html#8281103e6f23cb5c" class="k">var</a> <span id="r8 rd" class="r8 r">shapeType</span> = <span class="r7 r">leader</span> + <span class="r5 r">fileName</span>.<a href="@1@System.Runtime/A.html#69fc1d0aa6df8a90" class="i method">Replace</a>(<span class="s">&quot;--&quot;</span>, <span class="s">&quot;__&quot;</span>).<a href="@1@System.Runtime/A.html#69fc1d0aa6df8a90" class="i method">Replace</a>(<span class="s">&quot;-&quot;</span>, <span class="s">&quot;__&quot;</span>).<a href="@1@System.Runtime/A.html#987da5dfb39f1927" class="i method">Replace</a>(<span class="s">&#39;.&#39;</span>, <span class="s">&#39;_&#39;</span>);
 
            <b>if</b> (<a href="@1@System.Runtime/A.html#8281103e6f23cb5c" class="k">string</a>.<a href="@1@System.Runtime/A.html#23a8597f842071f4" class="i method">IsNullOrEmpty</a>(<span class="r6 r">displayType</span>))
            {
                <b>return</b> <span class="r8 r">shapeType</span>.<a href="@1@System.Runtime/A.html#2d51c212cb09178e" class="i method">ToLowerInvariant</a>();
            }
            <a href="@1@System.Runtime/A.html#225942ed7b7a3252" class="k">var</a> <span id="r9 rd" class="r9 r">firstBreakingSeparator</span> = <span class="r8 r">shapeType</span>.<a href="@1@System.Runtime/A.html#7d6aed52d875ec59" class="i method">IndexOf</a>(<span class="s">&quot;__&quot;</span>, <a href="@1@System.Runtime/A.html#702797def97ecb7c" class="t t">StringComparison</a>.<a href="@1@System.Runtime/A.html#87891a6d28c64c9b" class="i field">Ordinal</a>);
            <b>if</b> (<span class="r9 r">firstBreakingSeparator</span> &lt;= 0)
            {
                <b>return</b> (<span class="r8 r">shapeType</span> + <span class="s">&quot;_&quot;</span> + <span class="r6 r">displayType</span>).<a href="@1@System.Runtime/A.html#2d51c212cb09178e" class="i method">ToLowerInvariant</a>();
            }
 
            <b>return</b> (<span class="r8 r">shapeType</span>.<a href="@1@System.Runtime/A.html#8124961f027d9ac9" class="i method">Substring</a>(0, <span class="r9 r">firstBreakingSeparator</span>) + <span class="s">&quot;_&quot;</span> + <span class="r6 r">displayType</span> + <span class="r8 r">shapeType</span>.<a href="@1@System.Runtime/A.html#882fa7998d6ca35a" class="i method">Substring</a>(<span class="r9 r">firstBreakingSeparator</span>)).<a href="@1@System.Runtime/A.html#2d51c212cb09178e" class="i method">ToLowerInvariant</a>();
        }
    }
}
</pre></td></tr></table></div></body></html>
